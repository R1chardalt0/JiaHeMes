# 软件详细设计文档（完善版）
# 1 引言
## 1.1 编写目的
### 目标读者
本文档面向项目开发团队以及项目管理团队，为相关人员提供系统实现的详细技术指导。

### 文档用途
1. **指导开发实现**：提供系统编码、模块集成的技术依据，确保各模块实现符合设计规范和业务需求；
2. **测试验收依据**：提供系统功能、性能、接口等测试的设计基准，确保测试工作覆盖完整的系统功能点；
3. **运维部署参考**：提供系统部署、配置、监控的技术文档，保障系统稳定运行；

### 文档范围
本文档详细描述嘉和MES管理系统的系统架构、功能模块、数据库设计、接口设计等内容，覆盖系统从开发到部署的全生命周期技术实现细节，但不包含项目管理计划、商业需求分析等非技术实现内容。

## 1.2 项目背景
### 项目来源
本项目为嘉和生产线数字化转型的核心支撑系统，提出制造执行系统（MES）建设需求。

### 业务场景
本系统应用于嘉和生产线，覆盖从原材料投入、组装、测试、包装到成品入库的全生产流程。主要业务场景包括：
1. **生产计划管理**：接收ERP系统下发的生产订单，分解为可执行的车间生产计划；
2. **实时数据采集**：通过与生产设备对接，实时采集生产过程中的关键参数（如电压、电流、温度等）；
3. **生产调度监控**：可视化展示生产线运行状态，支持生产异常预警与快速响应；
4. **质量追溯管理**：建立从原材料到成品的全生命周期追溯体系；
5. **设备管理维护**：记录设备运行数据，支持预防性维护与故障分析。

### 核心价值
1. **提升生产效率**：通过自动化数据采集与智能调度，减少人工干预，提高生产线运行效率；
2. **保证产品质量**：实时监控生产过程参数，及时发现质量异常，降低不良品率；
3. **实现数字化管理**：建立完整的生产数据体系，为管理层决策提供数据支撑；
4. **增强合规能力**：满足客户对产品质量追溯的要求，提升企业市场竞争力；
5. **降低运营成本**：通过设备预防性维护，减少设备故障停机时间，降低生产成本。

## 1.3 参考材料
列出需求规格说明书、接口规范、技术标准等引用文档。

# 2 系统总体设计
## 2.1 整体架构
### 2.1.1 架构模式
本系统采用前后端分离架构模式，实现了前端展示与后端业务逻辑的解耦，支持多客户端接入与独立部署。

### 2.1.2 前端架构
- **核心框架**：React 19.1.0 + TypeScript 5.6.3
- **解决方案**：Ant Design Pro 6.0.0 + Umi Max 4.3.24
- **主要模块**：
  - 仪表盘（dashboard）：生产状态实时监控
  - 设备管理（device）：设备信息与运行状态管理
  - 系统管理（systems）：用户、权限、配置管理
  - 追溯管理（Trace）：产品全生命周期追溯
  - 历史记录（History）：生产历史数据查询
  - 生产设备管理（productionEquipment）：设备详细信息与维护记录

### 2.1.3 后端架构
- **核心框架**：.NET 8.0 + ASP.NET Core Web API
- **分层设计**：
  - 应用层（Application）：业务逻辑实现
  - 服务层（Service）：核心业务服务
  - 数据访问层（DbContexts）：数据库操作
  - 实体层（Entitys）：数据模型定义
  - 通用工具层（Common）：公共组件与工具
- **主要模块**：
  - 追溯模块（Trace）：产品追溯业务逻辑
  - 系统管理模块（Systems）：基础系统功能
  - Web API：对外接口提供
  - WPF客户端（Client）：设备管理桌面应用

### 2.1.4 部署拓扑
客户端 → Web API → 应用服务层 → 数据访问层 → PostgreSQL数据库

### 2.1.5 架构特点
- 模块化设计：业务逻辑按功能模块清晰划分
- 领域驱动设计风格：实体定义与业务逻辑分离
- 多客户端支持：Web客户端 + WPF桌面客户端
- 前后端松耦合：通过API接口实现数据交互
## 2.2 整体功能架构
### 2.2.1 核心功能模块
1. **生产管理模块**
   - 物料上传管理：原材料批次上传与记录（FeedMaterial）
   - 返工管理：不合格品返工流程处理（ReWork）
   - 跳站管理：生产工序跳站流程处理（JumpStation）

2. **设备管理模块**
   - 产线管理：生产线信息维护与管理（productionEquipment/productionLine）
   - 设备管理：生产设备信息维护与管理（productionEquipment/equipment）
   - 设备监控：生产设备运行状态实时监控（device/monitor）

3. **追溯管理模块**
   - SN表追溯：产品序列号追溯查询（Trace/MesSnListTrace）
   - 生产记录：生产过程数据记录与查询（Trace/ProductionRecords）
   - 产品追溯信息：产品全生命周期追溯详情（Trace/ProductTraceInfo）
   - 设备追溯信息：设备使用历史追溯（Trace/DeviceTraceInfo）

4. **基础设施模块**
   - BOM管理：物料清单维护与管理（infrastructure/Bom）
   - 工艺路线：生产工艺路线定义与管理（infrastructure/ProcessRoute）
   - 产品列表：产品信息维护与管理（infrastructure/ProductList）
   - 工单管理：生产工单创建与管理（infrastructure/WorkOrderManagement）
   - 订单列表：生产订单信息管理（infrastructure/OrderList）
   - 工位列表：生产工位信息维护（infrastructure/StationList）

5. **系统管理模块**
   - 用户管理：用户信息与权限分配（systems/user）
   - 角色管理：角色定义与权限配置（systems/role）
   - 菜单管理：系统菜单配置与管理（systems/menu）
   - 部门管理：组织机构与部门管理（systems/dept）
   - 职位管理：职位信息与权限配置（systems/position）
   - 操作日志：系统操作日志记录与查询（systems/operateLog）

6. **数据查询与分析模块**
   - 仪表盘：生产数据可视化展示（dashboard/analysis）
   - 历史记录：生产历史数据查询（History/DeviceTraceInfo, History/ProductTraceInfo）
   - 报表：生产报表生成与查询（Report/TraceSN）

7. **AI助手模块**
   - 豆包AI：AI辅助查询与分析（doubao-chat）

### 2.2.2 功能架构特点
- 业务逻辑清晰：按生产制造核心业务流程划分模块
- 数据关联性强：各模块间通过统一数据模型实现信息共享
- 扩展性良好：支持新增功能模块与业务流程

## 2.3 整体技术架构
### 2.3.1 前端技术栈
- **核心框架**：React 19.1.0 + TypeScript 5.6.3
- **企业级解决方案**：Ant Design Pro 6.0.0 + Umi Max 4.3.24
- **UI组件库**：Ant Design 5.26.4
- **专业组件**：@ant-design/pro-components 2.8.9
- **图表库**：@ant-design/charts 2.6.2、@ant-design/plots 2.6.3
- **工具库**：
  - dayjs 1.11.13（日期处理）
  - xlsx 0.18.5（Excel文件处理）
  - classnames 2.5.1（CSS类名管理）
  - swagger-ui-dist 5.27.1（API文档）

### 2.3.2 后端技术栈
- **核心框架**：.NET 8.0 + C#
- **Web API**：ASP.NET Core
- **ORM**：Entity Framework Core
- **任务调度**：Quartz 3.8.1
- **身份验证**：JWT（JSON Web Token）
- **架构模式**：
  - 分层架构（Application/Service/DbContexts/Entitys/Common）
  - 仓库模式（Repository Pattern）
  - 依赖注入

### 2.3.3 数据库
- **主数据库**：PostgreSQL

### 2.3.4 其他技术
- **AI集成**：豆包AI
- **桌面应用**：WPF（MVVM模式）
- **国际化**：支持多语言（zh-CN、en-US、ja-JP等）

## 2.4 设计目标
### 2.4.1 性能目标
- **响应时间**：
  - 普通查询响应时间 ≤1s（95%场景）
  - 复杂聚合查询响应时间 ≤2s（95%场景）
  - 设备数据实时上报延迟 ≤100ms
- **数据处理能力**：支持单表≥1000万条记录的高效查询

### 2.4.2 功能目标
- **完整的生产流程覆盖**：从原材料投入到成品出库的全流程管理
- **精准的产品追溯**：实现从原材料到成品的双向追溯
- **实时的生产监控**：生产线状态与设备参数实时可视化
- **智能的数据分析**：生产效率与质量指标多维度分析

### 2.4.3 技术目标
- **高可靠性**：系统可用性≥99.9%
- **可扩展性**：支持业务功能与用户规模的平滑扩展
- **可维护性**：模块化设计，便于系统维护与升级
- **安全性**：数据传输加密，权限控制严格

### 2.4.4 合规目标
- 符合ISO9001质量管理体系要求
- 满足客户对产品追溯的合规要求
## 2.5 设计原则
### 2.5.1 总体原则
业务逻辑下沉至后端，前端仅负责展示与交互
所有敏感操作需鉴权
### 2.5.2 实用性与先进性
采用成熟技术栈，避免过度设计
### 2.5.3 标准化、开放性、兼容性
RESTful API，JSON 格式，遵循 OpenAPI 3.0 规范
### 2.5.4 高可靠性与稳定性
关键接口幂等设计，异常自动重试机制（如消息队列）
### 2.5.5 易用性
接口语义清晰，错误码统一
### 2.5.6 灵活性与可扩展性
模块解耦，支持插件式扩展（如新增数据源）
### 2.5.7 经济性与投资保护
利用现有基础设施，避免重复采购

# 3 系统功能模块详细设计
## 3.1 生产管理
### 3.1.1 上料
#### 3.1.1.1 功能概述
上料模块是MES系统中负责物料批次管理的核心功能，主要实现以下功能：
- **物料批次上料**：将物料批次信息与生产设备、站点关联
- **批次规则验证**：根据BOM定义的规则验证批次号的有效性
- **批次使用追踪**：记录批次的使用情况，实现物料的精准追溯
- **SN绑定**：在生产过程中，将产品SN码与上料批次关联，建立物料使用的追溯关系
#### 3.1.1.2 模块逻辑
##### 3.1.1.2.1 前端逻辑
1. **设备选择**：用户从设备列表中选择设备，系统自动带入设备编码和绑定的工单编码
2. **站点选择**：系统根据工单关联的BOM，提取站点列表供用户选择
3. **产品选择**：系统根据选择的站点，提取对应产品列表供用户选择
4. **批次信息录入**：用户输入批次号和批次数量
5. **表单验证**：验证批次号、设备编码、站点编码、产品编码不能为空
6. **提交上料请求**：调用后端上料接口，处理响应结果
##### 3.1.1.2.2 后端逻辑
1. **设备验证**：验证设备是否存在且已绑定工单
2. **产品验证**：验证产品是否存在
3. **站点验证**：验证站点是否存在
4. **BOM验证**：验证BOM是否存在，获取批次规则和保质期信息
5. **批次验证**：验证批次号格式是否正确，检查批次号是否已被使用
6. **创建上料批次**：创建上料批次记录，关联设备、工单、站点和产品
7. **返回结果**：返回上料成功或失败的消息
##### 3.1.1.2.3 生产过程中的批次使用逻辑
1. **SN扫描**：生产过程中，扫描产品SN码
2. **批次关联**：查找可用的上料批次
3. **SN绑定**：创建SN与上料批次的关联记录
4. **批次使用更新**：更新批次的已使用数量
5. **批次状态检查**：当批次已使用数量达到批次数量时，标记为"已使用完"
6. **保质期检查**：检查批次是否过期，过期的批次标记为"已过期"
#### 3.1.1.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 物料上传接口 | `/api/CommonInterfase/FeedMaterial` | POST | 记录原材料批次的上料信息，实现物料批次与生产工单的关联 |

### 3.1.2 跳站

#### 3.1.2.1 功能概述
跳站模块是MES系统中处理生产过程中特殊情况的重要功能，主要实现以下功能：

- **SN跳站操作**：将产品从当前站点跳过到指定的目标站点
- **站点验证**：验证目标站点的有效性和顺序的正确性
- **跳站记录**：记录跳站操作的详细信息，实现生产过程的追溯

#### 3.1.2.2 模块逻辑

##### 3.1.2.2.1 前端逻辑
1. **SN码输入**：用户输入产品SN码，系统实时验证SN码的有效性
2. **当前站点查询**：系统根据SN码自动查询并显示当前站点信息
3. **目标站点选择**：系统根据当前站点和工艺路线，自动筛选出可用的目标站点列表（只能选择当前站点之后的站点）
4. **表单验证**：验证SN码和目标站点编码不能为空
5. **提交跳站请求**：调用后端跳站接口，处理响应结果
6. **操作反馈**：根据后端返回结果，显示跳站成功或失败的消息

##### 3.1.2.2.2 后端逻辑
1. **SN验证**：验证SN码是否存在于Current表中
2. **当前站点验证**：验证SN当前所在的站点是否存在
3. **目标站点验证**：验证目标跳站站点是否存在
4. **站点一致性检查**：检查当前站点与目标站点是否相同，避免重复操作
5. **工单验证**：验证SN关联的工单是否存在
6. **工艺路线验证**：验证当前站点和目标站点是否在工艺路线中存在
7. **站点顺序检查**：验证当前站点顺序是否小于目标站点顺序，确保跳站方向正确
8. **更新SN状态**：更新SN的当前站点为目标站点，标记状态为"跳站"
9. **记录跳站历史**：创建跳站操作的历史记录，包含跳站前后的站点信息
10. **返回结果**：返回跳站成功或失败的消息

#### 3.1.2.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 跳站接口 | `/api/CommonInterfase/JumpStation` | POST | 处理生产过程中的跳站操作，将产品从当前站点跳过到指定站点 |
| 获取SN当前状态接口 | `/api/Trace/MesSnListCurrent/GetBySnNumber` | GET | 根据SN码获取当前状态信息，包括当前站点 |
| 获取站点详情接口 | `/api/Infrastructure/StationList/GetById` | GET | 根据站点ID获取站点详细信息 |


### 3.1.3 返工

#### 3.1.3.1 功能概述
返工模块是MES系统中处理生产过程中异常情况的重要功能，主要实现以下功能：

- **SN返工操作**：将产品从当前站点返回到指定的目标站点
- **站点验证**：验证目标站点的有效性和顺序的正确性
- **物料解绑**：支持在返工过程中解绑已绑定的物料批次
- **返工记录**：记录返工操作的详细信息，实现生产过程的追溯
- **返工统计**：跟踪产品的返工次数和返工历史

#### 3.1.3.2 模块逻辑
                  
##### 3.1.3.2.1 前端逻辑
1. **SN码输入**：用户输入产品SN码，系统实时验证SN码的有效性
2. **当前站点查询**：系统根据SN码自动查询并显示当前站点信息
3. **目标站点选择**：系统根据当前站点和工艺路线，自动筛选出可用的目标站点列表（只能选择当前站点之前的站点）
4. **物料信息查询**：系统根据SN码和目标站点，自动查询并显示已绑定的物料信息
5. **物料解绑操作**：用户可以选择解绑部分或全部已绑定的物料
6. **表单验证**：验证SN码和目标站点编码不能为空
7. **提交返工请求**：调用后端返工接口，处理响应结果
8. **操作反馈**：根据后端返回结果，显示返工成功或失败的消息

##### 3.1.3.2.2 后端逻辑
1. **SN验证**：验证SN码是否存在于Current表中
2. **当前站点验证**：验证SN当前所在的站点是否存在
3. **目标站点验证**：验证目标返工站点是否存在
4. **站点一致性检查**：检查当前站点与目标站点是否相同，避免重复操作
5. **工单验证**：验证SN关联的工单是否存在
6. **工艺路线验证**：验证当前站点和目标站点是否在工艺路线中存在
7. **站点顺序检查**：验证当前站点顺序是否大于目标站点顺序，确保返工方向正确
8. **更新SN状态**：更新SN的当前站点为目标站点，标记状态为"返工"，记录返工开始和结束站点，增加返工次数
9. **记录返工历史**：创建返工操作的历史记录，包含返工前后的站点信息
10. **处理物料解绑**：如果请求中包含需要解绑的物料批次明细ID，将其标记为已解绑
11. **返回结果**：返回返工成功或失败的消息

#### 3.1.3.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 返工接口 | `/api/CommonInterfase/ReWork` | POST | 处理生产过程中的返工操作，将产品从当前站点返回到指定站点 |
| 获取SN当前状态接口 | `/api/Trace/MesSnListCurrent/GetBySnNumber` | GET | 根据SN码获取当前状态信息，包括当前站点 |
| 获取站点详情接口 | `/api/Infrastructure/StationList/GetById` | GET | 根据站点ID获取站点详细信息 |
| 获取物料批次明细接口 | `/api/Infrastructure/MESOrderBomBatch/MESOrderBomBatchItem/GetBySnNumber` | GET | 根据SN码获取已绑定的物料批次明细 |
| 获取物料批次接口 | `/api/Infrastructure/MESOrderBomBatch/MESOrderBomBatch/GetById` | GET | 根据批次ID获取物料批次信息 |
| 获取产品信息接口 | `/api/Infrastructure/ProductList/GetById` | GET | 根据产品ID获取产品详细信息 |


## 3.2 基础设施
### 3.2.1 工单管理

#### 3.2.1.1 功能概述
工单管理模块是MES系统中负责生产工单全生命周期管理的核心功能，主要实现以下功能：

- **工单列表查询**：支持分页查询和多条件筛选（工单编码、工单名称、产品信息、状态等）
- **工单详情查看**：查看工单的详细信息，包括基本信息、产品信息、BOM信息、工艺路线信息等
- **工单创建**：创建新的生产工单，支持产品选择和关联信息自动填充
- **工单更新**：更新工单的基本信息，仅允许更新状态为"新建"的工单
- **工单删除**：支持单个删除和批量删除工单
- **工单状态管理**：更新工单状态，支持状态切换时自动设置相应的时间字段
- **工单统计**：获取各状态工单的数量统计

#### 3.2.1.2 模块逻辑

##### 3.2.1.2.1 前端逻辑
1. **工单列表查询**：
   - 构建查询参数，包括分页参数和筛选条件
   - 调用后端分页查询接口获取工单列表
   - 为每条工单补充关联的产品、BOM和工艺路线信息
   - 展示工单列表，支持列排序和分页操作

2. **工单详情查看**：
   - 点击工单列表中的查看按钮或双击工单行
   - 调用后端获取工单详情接口
   - 补充关联的产品、BOM和工艺路线信息
   - 以详情表单形式展示工单信息

3. **工单创建**：
   - 点击新建工单按钮，打开创建表单
   - 填写工单基本信息（工单编码、工单名称等）
   - 点击选择产品按钮，打开产品选择弹窗
   - 选择产品后，自动填充关联的BOM和工艺路线信息
   - 验证表单数据的有效性
   - 调用后端创建工单接口，提交工单信息
   - 根据后端返回结果，显示创建成功或失败的消息

4. **工单更新**：
   - 点击工单列表中的编辑按钮，打开编辑表单
   - 表单自动填充现有工单信息
   - 修改工单信息
   - 验证表单数据的有效性
   - 调用后端更新工单接口，提交更新后的工单信息
   - 根据后端返回结果，显示更新成功或失败的消息

5. **工单删除**：
   - 点击工单列表中的删除按钮，或选择多个工单后点击批量删除按钮
   - 弹出确认删除对话框
   - 确认后调用后端删除工单接口
   - 根据后端返回结果，显示删除成功或失败的消息

6. **工单状态管理**：
   - 在工单详情页面或列表页面，点击状态更新按钮
   - 选择目标状态
   - 调用后端更新工单状态接口
   - 根据后端返回结果，显示状态更新成功或失败的消息

7. **工单统计**：
   - 调用后端获取工单统计信息接口
   - 展示各状态工单的数量统计

##### 3.2.1.2.2 后端逻辑
1. **分页查询工单列表**：
   - 验证分页参数的有效性
   - 构建查询条件，支持多条件筛选
   - 执行分页查询，获取工单列表和总数
   - 将工单实体转换为DTO，返回分页结果

2. **获取工单详情**：
   - 根据工单ID或工单编码查询工单信息
   - 将工单实体转换为DTO，返回详情

3. **创建工单**：
   - 验证工单编码的唯一性
   - 创建工单实体，设置默认状态为"新建"
   - 保存工单到数据库
   - 将创建的工单实体转换为DTO，返回结果

4. **更新工单**：
   - 验证工单是否存在
   - 验证工单状态是否为"新建"，只有新建状态的工单可以更新
   - 验证工单编码的唯一性（排除当前工单）
   - 更新工单信息
   - 保存更新到数据库
   - 将更新后的工单实体转换为DTO，返回结果

5. **删除工单**：
   - 验证工单ID列表是否为空
   - 查询要删除的工单是否存在
   - 从数据库中删除工单
   - 返回删除的工单数量

6. **更新工单状态**：
   - 验证工单是否存在
   - 更新工单状态
   - 根据状态变更自动设置相应的时间字段（如生产中状态设置实际开始时间，已完成状态设置实际结束时间）
   - 保存更新到数据库
   - 将更新后的工单实体转换为DTO，返回结果

7. **获取工单统计信息**：
   - 查询各状态工单的数量
   - 构建统计结果，返回各状态工单的数量

#### 3.2.1.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 分页查询工单列表接口 | `/api/OrderList/GetOrderListList` | GET | 查询工单列表，支持多种条件过滤和分页 |
| 根据ID获取工单详情接口 | `/api/OrderList/GetOrderListById` | GET | 根据工单ID获取工单的详细信息 |
| 根据工单编码获取工单详情接口 | `/api/OrderList/GetOrderListByCode` | GET | 根据工单编码获取工单的详细信息 |
| 创建工单接口 | `/api/OrderList/CreateOrderList` | POST | 创建新的工单 |
| 更新工单接口 | `/api/OrderList/UpdateOrderListById` | POST | 更新工单的信息 |
| 删除工单接口 | `/api/OrderList/DeleteOrderListByIds` | POST | 删除工单，支持单个删除和批量删除 |
| 更新工单状态接口 | `/api/OrderList/UpdateOrderStatus` | POST | 更新工单的状态 |
| 获取工单统计信息接口 | `/api/OrderList/GetOrderStatistics` | GET | 获取工单的统计信息，如各状态工单的数量 |
| 获取产品详情接口 | `/api/ProductList/GetProductListById` | GET | 根据产品ID获取产品的详细信息 |
| 获取BOM详情接口 | `/api/Bom/BomList/GetBomById` | GET | 根据BOM ID获取BOM的详细信息 |
| 获取工艺路线详情接口 | `/api/ProcessRoute/ProcessRoute/GetProcessRouteById` | GET | 根据工艺路线ID获取工艺路线的详细信息 |

### 3.2.2 站点管理

#### 3.2.2.1 功能概述

站点管理模块用于管理生产线上的各个站点信息，包括站点的基本信息管理和站点测试项管理。该模块支持站点的创建、编辑、删除、查询等操作，以及为每个站点配置测试项，确保每个站点都能正确执行相应的测试任务。

主要功能包括：
- 站点列表查询：支持分页查询和多条件筛选
- 站点信息管理：支持创建、编辑、删除站点信息
- 站点测试项管理：为每个站点配置测试项，包括测试项的创建、编辑、删除
- 批量操作：支持批量删除站点

#### 3.2.2.2 模块逻辑

##### 3.2.2.2.1 前端逻辑

1. **站点列表查询**：
   - 构建查询参数，包括分页参数和筛选条件（站点名称、站点编码）
   - 调用后端分页查询接口获取站点列表
   - 展示站点列表，支持列排序和分页操作
   - 支持批量选择站点进行批量删除操作

2. **站点详情查看**：
   - 双击站点列表中的站点行
   - 调用后端获取站点测试项接口
   - 展示站点的测试项列表

3. **站点创建**：
   - 点击新建站点按钮，打开创建表单
   - 填写站点基本信息（站点编码、站点名称、备注）
   - 验证表单数据的有效性（站点编码和站点名称为必填项）
   - 调用后端创建站点接口，提交站点信息
   - 根据后端返回结果，显示创建成功或失败的消息

4. **站点更新**：
   - 点击站点列表中的编辑按钮，打开编辑表单
   - 表单自动填充现有站点信息
   - 修改站点信息
   - 验证表单数据的有效性
   - 调用后端更新站点接口，提交更新后的站点信息
   - 根据后端返回结果，显示更新成功或失败的消息

5. **站点删除**：
   - 点击站点列表中的删除按钮，或选择多个站点后点击批量删除按钮
   - 弹出确认删除对话框
   - 确认后调用后端删除站点接口
   - 根据后端返回结果，显示删除成功或失败的消息

6. **测试项管理**：
   - 在站点详情页面，点击新建测试项按钮，打开测试项创建表单
   - 填写测试项信息（测试项名称、上限、下限、单位、搜索值、是否检查、备注）
   - 验证表单数据的有效性（测试项名称为必填项）
   - 调用后端创建测试项接口，提交测试项信息
   - 点击测试项列表中的编辑按钮，打开测试项编辑表单
   - 修改测试项信息
   - 调用后端更新测试项接口，提交更新后的测试项信息
   - 点击测试项列表中的删除按钮，弹出确认删除对话框
   - 确认后调用后端删除测试项接口

##### 3.2.2.2.2 后端逻辑

1. **站点列表查询**：
   - 验证分页参数的有效性
   - 构建查询条件，支持按站点名称和站点编码进行筛选
   - 执行分页查询，获取站点列表和总数
   - 将站点实体转换为DTO，返回分页结果

2. **站点创建**：
   - 验证站点编码的唯一性
   - 创建站点实体，设置站点基本信息
   - 将站点信息保存到数据库
   - 将站点实体转换为DTO，返回创建结果

3. **站点更新**：
   - 根据站点ID查找站点实体
   - 验证站点是否存在
   - 验证站点编码的唯一性（排除当前站点）
   - 更新站点基本信息
   - 将更新后的站点信息保存到数据库
   - 将站点实体转换为DTO，返回更新结果

4. **站点删除**：
   - 根据站点ID查找站点实体
   - 验证站点是否存在
   - 从数据库中删除站点信息
   - 返回删除成功的结果

5. **测试项管理**：
   - 为指定站点创建测试项
   - 更新指定站点的测试项信息
   - 删除指定站点的测试项
   - 根据站点ID获取测试项列表

#### 3.2.2.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 站点列表查询接口 | `/api/StationList/GetStationListList` | GET | 分页查询站点列表，支持多条件筛选 |
| 站点创建接口 | `/api/StationList/CreateStationList` | POST | 创建新的站点 |
| 站点更新接口 | `/api/StationList/UpdateStationList` | POST | 更新站点的信息 |
| 站点删除接口 | `/api/StationList/DeleteStationList` | POST | 删除站点，支持单个删除和批量删除 |
| 站点测试项查询接口 | `/api/StationTest/GetStationTestProjectByStationId` | GET | 根据站点ID获取测试项列表 |
| 测试项创建接口 | `/api/StationTest/CreateStationTestProject` | POST | 创建新的测试项 |
| 测试项更新接口 | `/api/StationTest/UpdateStationTestProject` | POST | 更新测试项的信息 |
| 测试项删除接口 | `/api/StationTest/DeleteStationTestProject` | POST | 删除测试项 |

### 3.2.3 产品管理

#### 3.2.3.1 功能概述

产品管理模块用于管理企业的产品信息，包括产品的基本信息管理、BOM关联和工艺路线关联。该模块支持产品的创建、编辑、删除、查询等操作，以及为每个产品关联相应的BOM和工艺路线，确保产品在生产过程中能够正确执行相应的工艺步骤和使用正确的物料。

主要功能包括：
- 产品列表查询：支持分页查询和多条件筛选（产品编码、产品名称、产品类型）
- 产品信息管理：支持创建、编辑、删除产品信息
- BOM关联：为每个产品关联相应的BOM，支持BOM的选择和管理
- 工艺路线关联：为每个产品关联相应的工艺路线，支持工艺路线的选择和管理
- 批量操作：支持批量删除产品

#### 3.2.3.2 模块逻辑

##### 3.2.3.2.1 前端逻辑

1. **产品列表查询**：
   - 构建查询参数，包括分页参数和筛选条件（产品编码、产品名称、产品类型）
   - 调用后端分页查询接口获取产品列表
   - 为每条产品补充关联的BOM和工艺路线信息
   - 展示产品列表，支持列排序和分页操作
   - 支持批量选择产品进行批量删除操作

2. **产品详情查看**：
   - 点击产品列表中的产品行
   - 在右侧抽屉中展示产品的详细信息
   - 显示产品的基本信息、BOM信息和工艺路线信息

3. **产品创建**：
   - 点击新建产品按钮，打开创建表单
   - 填写产品基本信息（产品编码、产品名称、产品类型、备注、最大返工次数）
   - 点击选择BOM按钮，打开BOM选择弹窗
   - 在BOM选择弹窗中搜索和选择相应的BOM
   - 点击选择工艺路线按钮，打开工艺路线选择弹窗
   - 在工艺路线选择弹窗中搜索和选择相应的工艺路线
   - 验证表单数据的有效性（产品编码和产品名称为必填项）
   - 调用后端创建产品接口，提交产品信息
   - 根据后端返回结果，显示创建成功或失败的消息

4. **产品更新**：
   - 点击产品列表中的编辑按钮，打开编辑表单
   - 表单自动填充现有产品信息，包括关联的BOM和工艺路线信息
   - 修改产品信息，支持重新选择BOM和工艺路线
   - 验证表单数据的有效性
   - 调用后端更新产品接口，提交更新后的产品信息
   - 根据后端返回结果，显示更新成功或失败的消息

5. **产品删除**：
   - 点击产品列表中的删除按钮，或选择多个产品后点击批量删除按钮
   - 弹出确认删除对话框
   - 确认后调用后端删除产品接口
   - 根据后端返回结果，显示删除成功或失败的消息

##### 3.2.3.2.2 后端逻辑

1. **产品列表查询**：
   - 验证分页参数的有效性
   - 构建查询条件，支持按产品编码、产品名称和产品类型进行模糊匹配
   - 执行分页查询，获取产品列表和总数
   - 将产品实体转换为DTO，返回分页结果

2. **产品创建**：
   - 验证产品编码的唯一性
   - 创建产品实体，设置产品基本信息、BOM ID和工艺路线 ID
   - 将产品信息保存到数据库
   - 将产品实体转换为DTO，返回创建结果

3. **产品更新**：
   - 根据产品ID查找产品实体
   - 验证产品是否存在
   - 验证产品编码的唯一性（排除当前产品）
   - 更新产品基本信息、BOM ID和工艺路线 ID
   - 将更新后的产品信息保存到数据库
   - 将产品实体转换为DTO，返回更新结果

4. **产品删除**：
   - 根据产品ID列表查找产品实体
   - 验证产品是否存在
   - 从数据库中删除产品信息
   - 返回删除成功的数量

#### 3.2.3.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 产品列表查询接口 | `/api/ProductList/GetProductListList` | GET | 分页查询产品列表，支持多条件筛选 |
| 产品创建接口 | `/api/ProductList/CreateProductList` | POST | 创建新的产品 |
| 产品更新接口 | `/api/ProductList/UpdateProductList` | POST | 更新产品的信息 |
| 产品删除接口 | `/api/ProductList/DeleteProductList` | POST | 删除产品，支持单个删除和批量删除 |
| BOM列表查询接口 | `/api/Bom/BomList/GetBomList` | GET | 查询BOM列表，用于产品关联BOM |
| 工艺路线列表查询接口 | `/api/ProcessRoute/ProcessRoute/GetProcessRouteList` | GET | 查询工艺路线列表，用于产品关联工艺路线 |

### 3.2.4 BOM管理

#### 3.2.4.1 功能概述

BOM（Bill of Materials）管理模块用于管理企业的物料清单信息，包括BOM的基本信息管理和BOM子项管理。该模块支持BOM的创建、编辑、删除、查询等操作，以及为每个BOM添加、编辑、删除子项，确保产品在生产过程中能够使用正确的物料。

主要功能包括：
- BOM列表查询：支持分页查询和多条件筛选（BOM编码、BOM名称、状态）
- BOM信息管理：支持创建、编辑、删除BOM信息
- BOM子项管理：为每个BOM添加、编辑、删除子项，包括子项的站点编码、批次规则、批次数量、产品关联等信息
- 批量操作：支持批量删除BOM

#### 3.2.4.2 模块逻辑

##### 3.2.4.2.1 前端逻辑

1. **BOM列表查询**：
   - 构建查询参数，包括分页参数和筛选条件（BOM编码、BOM名称、状态）
   - 调用后端分页查询接口获取BOM列表
   - 展示BOM列表，支持列排序和分页操作
   - 支持批量选择BOM进行批量删除操作

2. **BOM详情查看**：
   - 双击BOM列表中的BOM行
   - 展示BOM的详细信息，包括基本信息和BOM子项
   - BOM子项以卡片形式展示，支持添加、编辑和删除操作

3. **BOM创建**：
   - 点击新建BOM按钮，打开创建表单
   - 填写BOM基本信息（BOM编码、BOM名称、状态、备注）
   - 验证表单数据的有效性（BOM编码和BOM名称为必填项）
   - 调用后端创建BOM接口，提交BOM信息
   - 根据后端返回结果，显示创建成功或失败的消息

4. **BOM更新**：
   - 点击BOM列表中的编辑按钮，打开编辑表单
   - 表单自动填充现有BOM信息
   - 修改BOM信息
   - 验证表单数据的有效性
   - 调用后端更新BOM接口，提交更新后的BOM信息
   - 根据后端返回结果，显示更新成功或失败的消息

5. **BOM删除**：
   - 点击BOM列表中的删除按钮，或选择多个BOM后点击批量删除按钮
   - 弹出确认删除对话框
   - 确认后调用后端删除BOM接口
   - 根据后端返回结果，显示删除成功或失败的消息

6. **BOM子项管理**：
   - 在BOM详情页面，点击添加子项按钮，打开子项创建表单
   - 填写子项信息（站点编码、批次规则、批次数量、批次SN数量、产品关联、备注等）
   - 点击选择产品按钮，打开产品选择弹窗
   - 在产品选择弹窗中搜索和选择相应的产品
   - 验证表单数据的有效性
   - 调用后端创建BOM子项接口，提交子项信息
   - 点击子项卡片中的编辑按钮，打开子项编辑表单
   - 修改子项信息
   - 调用后端更新BOM子项接口，提交更新后的子项信息
   - 点击子项卡片中的删除按钮，弹出确认删除对话框
   - 确认后调用后端删除BOM子项接口

##### 3.2.4.2.2 后端逻辑

1. **BOM列表查询**：
   - 验证分页参数的有效性
   - 构建查询条件，支持按BOM编码、BOM名称进行模糊匹配，按状态进行精确匹配
   - 执行分页查询，获取BOM列表和总数
   - 将BOM实体转换为DTO，返回分页结果

2. **BOM创建**：
   - 验证状态值的有效性（只能是0或1）
   - 验证BOM编码的唯一性
   - 创建BOM实体，设置BOM基本信息
   - 将BOM信息保存到数据库
   - 将BOM实体转换为DTO，返回创建结果

3. **BOM更新**：
   - 验证状态值的有效性（只能是0或1）
   - 根据BOM ID查找BOM实体
   - 验证BOM是否存在
   - 验证BOM编码的唯一性（排除当前BOM）
   - 更新BOM基本信息
   - 将更新后的BOM信息保存到数据库
   - 将BOM实体转换为DTO，返回更新结果

4. **BOM删除**：
   - 验证是否有关联的BOM子项
   - 如果有关联的BOM子项，抛出异常阻止删除
   - 根据BOM ID列表查找BOM实体
   - 验证BOM是否存在
   - 从数据库中删除BOM信息
   - 返回删除成功的数量

5. **BOM子项管理**：
   - **BOM子项列表查询**：验证分页参数的有效性，构建查询条件，执行分页查询，获取BOM子项列表和总数，将BOM子项实体转换为DTO，返回分页结果
   - **BOM子项创建**：创建BOM子项实体，设置子项基本信息，将BOM子项信息保存到数据库，将BOM子项实体转换为DTO，返回创建结果
   - **BOM子项更新**：根据BOM子项ID查找BOM子项实体，验证BOM子项是否存在，更新BOM子项基本信息，将更新后的BOM子项信息保存到数据库，将BOM子项实体转换为DTO，返回更新结果
   - **BOM子项删除**：根据BOM子项ID列表查找BOM子项实体，验证BOM子项是否存在，从数据库中删除BOM子项信息，返回删除成功的数量

#### 3.2.4.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| BOM列表查询接口 | `/api/Bom/BomList/GetBomList` | GET | 分页查询BOM列表，支持多条件筛选 |
| BOM详情查询接口 | `/api/Bom/BomList/GetBomById` | GET | 根据BOM ID获取BOM的详细信息 |
| BOM创建接口 | `/api/Bom/BomList/CreateBomList` | POST | 创建新的BOM |
| BOM更新接口 | `/api/Bom/BomList/UpdateBomListById` | POST | 更新BOM的信息 |
| BOM删除接口 | `/api/Bom/BomList/DeleteBomListByIds` | POST | 删除BOM，支持单个删除和批量删除 |
| BOM子项列表查询接口 | `/api/Bom/BomItem/GetBomItemList` | GET | 分页查询BOM子项列表，支持多条件筛选 |
| BOM子项详情查询接口 | `/api/Bom/BomItem/GetBomItemById` | GET | 根据BOM子项ID获取BOM子项的详细信息 |
| BOM子项创建接口 | `/api/Bom/BomItem/CreateBomItem` | POST | 创建新的BOM子项 |
| BOM子项更新接口 | `/api/Bom/BomItem/UpdateBomItemById` | POST | 更新BOM子项的信息 |
| BOM子项删除接口 | `/api/Bom/BomItem/DeleteBomItemByIds` | POST | 删除BOM子项，支持单个删除和批量删除 |
| 产品列表查询接口 | `/api/ProductList/GetProductListList` | GET | 查询产品列表，用于BOM子项关联产品 |
| 站点列表查询接口 | `/api/StationList/GetStationListList` | GET | 查询站点列表，用于BOM子项关联站点 |

### 3.2.5 工艺路线管理

#### 3.2.5.1 功能概述

工艺路线管理模块用于管理企业的生产工艺路线信息，包括工艺路线的基本信息管理、工艺路线子项管理和工艺路线测试项管理。该模块支持工艺路线的创建、编辑、删除、查询等操作，以及为每个工艺路线添加、编辑、删除子项和测试项，确保产品在生产过程中能够按照正确的工艺路线进行加工。

主要功能包括：
- 工艺路线列表查询：支持分页查询和多条件筛选（工艺路线编码、工艺路线名称、状态）
- 工艺路线信息管理：支持创建、编辑、删除工艺路线信息
- 工艺路线子项管理：为每个工艺路线添加、编辑、删除子项，包括子项的站点编码、必须通过站点、检查站点列表、首站标志、检查所有标志、工艺路线序号、最大NG数量等信息
- 工艺路线测试项管理：为每个工艺路线子项添加、编辑、删除测试项，包括测试项的上限、下限、单位、参数键、是否检查、备注等信息
- 批量操作：支持批量删除工艺路线

#### 3.2.5.2 模块逻辑

##### 3.2.5.2.1 前端逻辑

1. **工艺路线列表查询**：
   - 构建查询参数，包括分页参数和筛选条件（工艺路线编码、工艺路线名称、状态）
   - 调用后端分页查询接口获取工艺路线列表
   - 展示工艺路线列表，支持列排序和分页操作
   - 支持批量选择工艺路线进行批量删除操作

2. **工艺路线详情查看**：
   - 双击工艺路线列表中的工艺路线行
   - 展示工艺路线的详细信息，包括基本信息和工艺路线子项
   - 工艺路线子项以列表形式展示，支持添加、编辑、删除操作和查看测试项

3. **工艺路线创建**：
   - 点击新建工艺路线按钮，打开创建表单
   - 填写工艺路线基本信息（工艺路线编码、工艺路线名称、状态、备注）
   - 验证表单数据的有效性（工艺路线编码和工艺路线名称为必填项）
   - 调用后端创建工艺路线接口，提交工艺路线信息
   - 根据后端返回结果，显示创建成功或失败的消息

4. **工艺路线更新**：
   - 点击工艺路线列表中的编辑按钮，打开编辑表单
   - 表单自动填充现有工艺路线信息
   - 修改工艺路线信息
   - 验证表单数据的有效性
   - 调用后端更新工艺路线接口，提交更新后的工艺路线信息
   - 根据后端返回结果，显示更新成功或失败的消息

5. **工艺路线删除**：
   - 点击工艺路线列表中的删除按钮，或选择多个工艺路线后点击批量删除按钮
   - 弹出确认删除对话框
   - 确认后调用后端删除工艺路线接口
   - 根据后端返回结果，显示删除成功或失败的消息

6. **工艺路线子项管理**：
   - 在工艺路线详情页面，点击添加工艺路线子项按钮，打开子项创建表单
   - 填写子项信息（站点编码、必须通过站点、检查站点列表、首站标志、检查所有标志、工艺路线序号、最大NG数量、备注等）
   - 验证表单数据的有效性
   - 调用后端创建工艺路线子项接口，提交子项信息
   - 点击子项列表中的编辑按钮，打开子项编辑表单
   - 修改子项信息
   - 调用后端更新工艺路线子项接口，提交更新后的子项信息
   - 点击子项列表中的删除按钮，弹出确认删除对话框
   - 确认后调用后端删除工艺路线子项接口
   - 点击子项列表中的查看测试项按钮，打开测试项列表模态框

7. **工艺路线测试项管理**：
   - 在测试项列表模态框中，点击新建测试项按钮，打开测试项创建表单
   - 填写测试项信息（测试项、上限、下限、单位、是否检查、备注等）
   - 验证表单数据的有效性
   - 调用后端创建工艺路线测试项接口，提交测试项信息
   - 点击测试项列表中的编辑按钮，打开测试项编辑表单
   - 修改测试项信息
   - 调用后端更新工艺路线测试项接口，提交更新后的测试项信息
   - 点击测试项列表中的删除按钮，弹出确认删除对话框
   - 确认后调用后端删除工艺路线测试项接口

##### 3.2.5.2.2 后端逻辑

1. **工艺路线列表查询**：
   - 验证分页参数的有效性
   - 构建查询条件，支持按工艺路线编码、工艺路线名称进行模糊匹配，按状态进行精确匹配
   - 执行分页查询，获取工艺路线列表和总数
   - 将工艺路线实体转换为DTO，返回分页结果

2. **工艺路线创建**：
   - 验证状态值的有效性（只能是0或1）
   - 验证工艺路线编码的唯一性
   - 创建工艺路线实体，设置工艺路线基本信息
   - 将工艺路线信息保存到数据库
   - 将工艺路线实体转换为DTO，返回创建结果

3. **工艺路线更新**：
   - 验证状态值的有效性（只能是0或1）
   - 根据工艺路线ID查找工艺路线实体
   - 验证工艺路线是否存在
   - 验证工艺路线编码的唯一性（排除当前工艺路线）
   - 更新工艺路线基本信息
   - 将更新后的工艺路线信息保存到数据库
   - 将工艺路线实体转换为DTO，返回更新结果

4. **工艺路线删除**：
   - 根据工艺路线ID列表查找工艺路线实体
   - 验证工艺路线是否存在
   - 从数据库中删除工艺路线信息
   - 返回删除成功的数量

5. **工艺路线子项管理**：
   - **工艺路线子项列表查询**：验证分页参数的有效性，构建查询条件，执行分页查询，获取工艺路线子项列表和总数，将工艺路线子项实体转换为DTO，返回分页结果
   - **工艺路线子项创建**：创建工艺路线子项实体，设置子项基本信息，将工艺路线子项信息保存到数据库，将工艺路线子项实体转换为DTO，返回创建结果
   - **工艺路线子项更新**：根据工艺路线子项ID查找工艺路线子项实体，验证工艺路线子项是否存在，更新工艺路线子项基本信息，将更新后的工艺路线子项信息保存到数据库，将工艺路线子项实体转换为DTO，返回更新结果
   - **工艺路线子项删除**：根据工艺路线子项ID列表查找工艺路线子项实体，验证工艺路线子项是否存在，从数据库中删除工艺路线子项信息，返回删除成功的数量

6. **工艺路线测试项管理**：
   - **工艺路线测试项列表查询**：验证分页参数的有效性，构建查询条件，执行分页查询，获取工艺路线测试项列表和总数，将工艺路线测试项实体转换为DTO，返回分页结果
   - **工艺路线测试项创建**：创建工艺路线测试项实体，设置测试项基本信息，将工艺路线测试项信息保存到数据库，将工艺路线测试项实体转换为DTO，返回创建结果
   - **工艺路线测试项更新**：根据工艺路线测试项ID查找工艺路线测试项实体，验证工艺路线测试项是否存在，更新工艺路线测试项基本信息，将更新后的工艺路线测试项信息保存到数据库，将工艺路线测试项实体转换为DTO，返回更新结果
   - **工艺路线测试项删除**：根据工艺路线测试项ID列表查找工艺路线测试项实体，验证工艺路线测试项是否存在，从数据库中删除工艺路线测试项信息，返回删除成功的数量

#### 3.2.5.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 工艺路线列表查询接口 | `/api/ProcessRoute/GetProcessRouteList` | GET | 分页查询工艺路线列表，支持多条件筛选 |
| 工艺路线详情查询接口 | `/api/ProcessRoute/GetProcessRouteById` | GET | 根据工艺路线ID获取工艺路线的详细信息 |
| 工艺路线创建接口 | `/api/ProcessRoute/CreateProcessRoute` | POST | 创建新的工艺路线 |
| 工艺路线更新接口 | `/api/ProcessRoute/UpdateProcessRoute` | POST | 更新工艺路线的信息 |
| 工艺路线删除接口 | `/api/ProcessRoute/DeleteProcessRoute` | POST | 删除工艺路线，支持单个删除和批量删除 |
| 工艺路线子项列表查询接口 | `/api/ProcessRoute/ProcessRouteItem/GetProcessRouteItemList` | GET | 分页查询工艺路线子项列表，支持多条件筛选 |
| 工艺路线子项详情查询接口 | `/api/ProcessRoute/ProcessRouteItem/GetProcessRouteItemById` | GET | 根据工艺路线子项ID获取工艺路线子项的详细信息 |
| 工艺路线子项创建接口 | `/api/ProcessRoute/ProcessRouteItem/CreateProcessRouteItem` | POST | 创建新的工艺路线子项 |
| 工艺路线子项更新接口 | `/api/ProcessRoute/ProcessRouteItem/UpdateProcessRouteItem` | POST | 更新工艺路线子项的信息 |
| 工艺路线子项删除接口 | `/api/ProcessRoute/ProcessRouteItem/DeleteProcessRouteItem` | POST | 删除工艺路线子项，支持单个删除和批量删除 |
| 工艺路线测试项列表查询接口 | `/api/ProcessRoute/ProcessRouteItemTest/GetProcessRouteItemTestList` | GET | 分页查询工艺路线测试项列表，支持多条件筛选 |
| 工艺路线测试项详情查询接口 | `/api/ProcessRoute/ProcessRouteItemTest/GetProcessRouteItemTestById` | GET | 根据工艺路线测试项ID获取工艺路线测试项的详细信息 |
| 工艺路线测试项创建接口 | `/api/ProcessRoute/ProcessRouteItemTest/CreateProcessRouteItemTest` | POST | 创建新的工艺路线测试项 |
| 工艺路线测试项更新接口 | `/api/ProcessRoute/ProcessRouteItemTest/UpdateProcessRouteItemTest` | POST | 更新工艺路线测试项的信息 |
| 工艺路线测试项删除接口 | `/api/ProcessRoute/ProcessRouteItemTest/DeleteProcessRouteItemTest` | POST | 删除工艺路线测试项，支持单个删除和批量删除 |
| 站点列表查询接口 | `/api/StationList/GetStationListList` | GET | 查询站点列表，用于工艺路线子项关联站点 |

## 3.3 信息追溯
### 3.3.1 SN表追溯
#### 3.3.1.1 功能概述

SN表追溯模块用于追溯产品的生产过程信息，通过输入产品的SN号，系统可以查询并展示该产品的完整生产记录，包括基本信息、工位过站记录、测试数据和上料批次信息。该模块为企业提供了产品质量追溯和生产过程监控的能力，有助于快速定位生产问题和质量异常。

主要功能包括：
- SN号输入和验证：用户输入产品SN号，系统实时验证SN号的有效性
- SN追溯数据查询：根据SN号查询产品的完整生产记录
- 基本信息展示：展示产品的SN号、订单号、产品代码、当前工位、工位状态、是否异常、创建时间和更新时间
- 工位信息展示：展示产品的历史过站记录，包括工位代码、工位名称、工位状态、资源代码、测试结果、备注、测试时间和测试数据
- 批次信息展示：展示产品的上料批次信息，包括批次代码、工位代码、产品代码、批次数量、完成数量、状态和创建时间

#### 3.3.1.2 模块逻辑

##### 3.3.1.2.1 前端逻辑

1. **SN号输入和验证**：
   - 用户在输入框中输入产品SN号
   - 系统验证SN号是否为空
   - 支持按回车键触发查询操作

2. **SN追溯数据查询**：
   - 点击查询按钮，调用后端SN追溯接口
   - 显示加载状态
   - 处理后端返回的追溯数据
   - 处理查询失败的情况，显示错误消息
   - 处理未找到SN号的情况，显示提示信息

3. **双击SN号重新查询**：
   - 双击SN号，调用后端SN追溯接口重新查询该SN码的历史记录
   - 处理后端返回的追溯数据
   - 处理查询失败的情况，显示错误消息
   - 处理未找到SN号的情况，显示提示信息

4. **基本信息展示**：
   - 以卡片形式展示产品的基本信息
   - 使用网格布局，自动适应不同屏幕尺寸
   - 展示SN号、订单号、产品代码、当前工位、工位状态、是否异常、创建时间和更新时间

5. **工位信息展示**：
   - 以表格形式展示产品的历史过站记录
   - 表格列包括工位代码、工位名称、工位状态、资源代码、测试结果、备注、测试时间和测试数据
   - 测试结果使用不同颜色区分合格和不合格
   - 测试数据以并行转列的形式展示，只显示参数键和测试值
   - 测试值根据测试结果使用不同颜色区分

6. **批次信息展示**：
   - 以表格形式展示产品的上料批次信息
   - 表格列包括批次代码、工位代码、产品代码、批次数量、完成数量、状态和创建时间
   - 状态使用不同颜色区分正常和异常

##### 3.3.1.2.2 后端逻辑

1. **SN号验证**：
   - 验证SN号是否为空
   - 如果SN号为空，返回错误信息

2. **SN当前状态查询**：
   - 查询SN的当前状态信息，包含工单、当前站点和产品信息
   - 如果SN不存在，返回错误信息

3. **SN历史过站记录查询**：
   - 查询SN的历史过站记录，包含站点和设备资源信息
   - 按创建时间排序

4. **SN测试数据查询**：
   - 根据历史记录ID关联查询SN的测试数据

5. **SN上料批次查询**：
   - 查询SN的上料批次及明细信息，包含批次和站点信息

6. **SN追溯结果组装**：
   - 组装SN追溯结果DTO，包含SN的基本信息、工位过站记录、测试数据和上料批次信息
   - 返回组装后的追溯结果

#### 3.3.1.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| SN追溯接口 | `/api/CommonInterfase/TraceSN` | GET | 根据SN号查询产品的完整生产记录，包括基本信息、工位过站记录、测试数据和上料批次信息 |

### 3.3.2 批次追溯

#### 3.3.2.1 功能概述

批次追溯模块用于追溯原材料批次的使用情况，通过输入批次号，系统可以查询并展示该批次的完整使用记录，包括批次基本信息、上料记录、使用记录和关联的产品信息。该模块为企业提供了原材料批次追溯和使用监控的能力，有助于快速定位原材料相关的生产问题和质量异常。

主要功能包括：
- 批次号输入和验证：用户输入原材料批次号，系统实时验证批次号的有效性
- 批次追溯数据查询：根据批次号查询批次的完整使用记录
- 批次基本信息展示：展示批次的批次号、产品代码、上料数量、完成数量、状态、创建时间等基本信息
- 上料记录展示：展示批次的上料记录，包括上料时间、上料站点、上料设备等信息
- 使用记录展示：展示批次的使用记录，包括使用时间、使用站点、使用设备、使用数量等信息
- 关联产品展示：展示批次关联的产品信息，包括产品SN号、产品状态、生产时间等信息
- 双击批次号重新查询：支持双击基本信息中的批次号重新查询该批次的历史记录

#### 3.3.2.2 模块逻辑

##### 3.3.2.2.1 前端逻辑

1. **批次号输入和验证**：
   - 用户在输入框中输入原材料批次号
   - 系统验证批次号是否为空
   - 支持按回车键触发查询操作

2. **批次追溯数据查询**：
   - 点击查询按钮，调用后端批次追溯接口
   - 显示加载状态
   - 处理后端返回的追溯数据
   - 处理查询失败的情况，显示错误消息
   - 处理未找到批次号的情况，显示提示信息

3. **双击批次号重新查询**：
   - 双击批次号，调用后端批次追溯接口重新查询该批次的历史记录
   - 处理后端返回的追溯数据
   - 处理查询失败的情况，显示错误消息
   - 处理未找到批次号的情况，显示提示信息

4. **批次基本信息展示**：
   - 以卡片形式展示批次的基本信息
   - 使用网格布局，自动适应不同屏幕尺寸
   - 展示批次号、产品代码、上料数量、完成数量、状态、创建时间等基本信息

5. **上料记录展示**：
   - 以表格形式展示批次的上料记录
   - 表格列包括上料时间、上料站点、上料设备、上料数量等信息

6. **使用记录展示**：
   - 以表格形式展示批次的使用记录
   - 表格列包括使用时间、使用站点、使用设备、使用数量、操作人员等信息

7. **关联产品展示**：
   - 以表格形式展示批次关联的产品信息
   - 表格列包括产品SN号、产品状态、生产时间、生产站点等信息

##### 3.3.2.2.2 后端逻辑

1. **批次号验证**：
   - 验证批次号是否为空
   - 如果批次号为空，返回错误信息

2. **批次基本信息查询**：
   - 根据批次号查询批次的基本信息，包含产品信息
   - 如果批次不存在，返回错误信息

3. **批次上料记录查询**：
   - 根据批次号查询批次的上料记录，包含站点和设备信息
   - 按上料时间排序

4. **批次使用记录查询**：
   - 根据批次号查询批次的使用记录，包含站点、设备和操作人员信息
   - 按使用时间排序

5. **批次关联产品查询**：
   - 根据批次号查询批次关联的产品信息，包含产品状态、生产时间和生产站点信息
   - 按生产时间排序

6. **批次追溯结果组装**：
   - 组装批次追溯结果DTO，包含批次的基本信息、上料记录、使用记录和关联产品信息
   - 返回组装后的追溯结果

#### 3.3.2.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 批次追溯接口 | `/api/CommonInterfase/TraceBatch` | GET | 根据批次号查询批次的完整使用记录，包括基本信息、上料记录、使用记录和关联产品信息 |
| 批次列表查询接口 | `/api/OrderBomBatch/GetOrderBomBatchList` | GET | 查询批次列表，用于批次选择和验证 |
| 站点列表查询接口 | `/api/StationList/GetStationListList` | GET | 查询站点列表，用于批次记录关联站点 |
| 设备列表查询接口 | `/api/Resource/GetResourceList` | GET | 查询设备列表，用于批次记录关联设备 |

### 3.3.3 SN单件追溯

#### 3.3.3.1 功能概述

SN单件追溯模块用于追溯单个产品的完整生产过程信息，通过输入产品的SN号，系统可以查询并展示该产品的完整生产记录，包括基本信息、工位过站记录、测试数据和上料批次信息。该模块为企业提供了产品质量追溯和生产过程监控的能力，有助于快速定位生产问题和质量异常。

主要功能包括：
- SN号输入和验证：用户输入产品SN号，系统实时验证SN号的有效性
- SN追溯数据查询：根据SN号查询产品的完整生产记录
- 双击SN号重新查询：支持双击基本信息中的SN号重新查询该SN码的历史记录
- 基本信息展示：展示产品的SN号、订单号、产品代码、当前工位、工位状态、是否异常、创建时间和更新时间
- 工位信息展示：展示产品的历史过站记录，包括工位代码、工位名称、工位状态、资源代码、测试结果、备注、测试时间和测试数据
- 批次信息展示：展示产品的上料批次信息，包括批次代码、工位代码、产品代码、批次数量、完成数量、状态和创建时间

#### 3.3.3.2 模块逻辑

##### 3.3.3.2.1 前端逻辑

1. **SN号输入和验证**：
   - 用户在输入框中输入产品SN号
   - 系统验证SN号是否为空
   - 支持按回车键触发查询操作

2. **SN追溯数据查询**：
   - 点击查询按钮，调用后端SN追溯接口
   - 显示加载状态
   - 处理后端返回的追溯数据
   - 处理查询失败的情况，显示错误消息
   - 处理未找到SN号的情况，显示提示信息

3. **基本信息展示**：
   - 以卡片形式展示产品的基本信息
   - 使用网格布局，自动适应不同屏幕尺寸
   - 展示SN号、订单号、产品代码、当前工位、工位状态、是否异常、创建时间和更新时间

4. **工位信息展示**：
   - 以表格形式展示产品的历史过站记录
   - 表格列包括工位代码、工位名称、工位状态、资源代码、测试结果、备注、测试时间和测试数据
   - 测试结果使用不同颜色区分合格和不合格
   - 测试数据以并行转列的方式展示，只显示参数键和测试值

5. **批次信息展示**：
   - 以表格形式展示产品的上料批次信息
   - 表格列包括批次代码、工位代码、产品代码、批次数量、完成数量、状态和创建时间
   - 状态使用不同颜色区分正常和异常

##### 3.3.3.2.2 后端逻辑

1. **SN号验证**：
   - 验证SN号是否为空
   - 如果SN号为空，返回错误信息

2. **SN当前状态查询**：
   - 查询SN的当前状态信息，包含工单、当前站点和产品信息
   - 如果SN不存在，返回错误信息

3. **SN历史过站记录查询**：
   - 查询SN的历史过站记录，包含站点和设备资源信息
   - 按创建时间排序

4. **SN测试数据查询**：
   - 根据历史记录ID关联查询SN的测试数据

5. **SN上料批次查询**：
   - 查询SN的上料批次及明细信息，包含批次和站点信息

6. **SN追溯结果组装**：
   - 组装SN追溯结果DTO，包含SN的基本信息、工位过站记录、测试数据和上料批次信息
   - 返回组装后的追溯结果

#### 3.3.3.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| SN追溯接口 | `/api/CommonInterfase/TraceSN` | GET | 根据SN号查询产品的完整生产记录，包括基本信息、工位过站记录、测试数据和上料批次信息 |
| SN实时状态查询接口 | `/api/MesSnListCurrent/GetMesSnListCurrents` | GET | 分页查询SN实时状态列表，用于SN验证和状态查询 |
| SN历史记录查询接口 | `/api/MesSnListHistory/GetMesSnListHistories` | GET | 分页查询SN历史记录列表，用于SN历史数据查询 |

## 3.4 产线设备管理
### 3.4.1 产线管理

#### 3.4.1.1 功能概述

产线管理模块用于管理企业的生产线信息，包括产线的创建、编辑、删除、查询和状态管理。该模块为企业提供了生产线的全生命周期管理能力，有助于企业规范化生产线管理流程，提高生产管理效率。

主要功能包括：
- 产线列表查询：支持分页查询、产线名称和编号搜索、时间区间搜索
- 产线详情查看：点击产线名称查看详细信息
- 产线创建：支持输入产线名称、编号、状态和描述信息
- 产线编辑：支持修改产线的各项信息
- 产线删除：支持单个删除和批量删除产线
- 产线状态管理：支持启用/禁用产线状态

#### 3.4.1.2 模块逻辑

##### 3.4.1.2.1 前端逻辑

1. **产线列表查询**：
   - 用户进入产线管理页面，系统自动加载产线列表
   - 支持输入产线名称和编号进行搜索
   - 支持选择时间区间进行搜索
   - 支持分页查询，可调整每页显示数量

2. **产线详情查看**：
   - 点击产线名称，从右侧滑出详情抽屉
   - 详情抽屉展示产线的完整信息
   - 支持关闭详情抽屉

3. **产线创建**：
   - 点击"新增产线"按钮，打开创建产线表单
   - 表单验证产线名称和编号不能为空
   - 产线编号只能包含字母、数字、下划线和横线
   - 表单提交后，系统调用后端创建产线接口
   - 创建成功后，系统自动刷新产线列表并显示成功消息

4. **产线编辑**：
   - 点击产线操作列的"编辑"按钮，打开编辑产线表单
   - 表单自动填充当前产线的信息
   - 表单验证产线名称和编号不能为空
   - 产线编号只能包含字母、数字、下划线和横线
   - 表单提交后，系统调用后端更新产线接口
   - 更新成功后，系统自动刷新产线列表并显示成功消息

5. **产线删除**：
   - 点击产线操作列的"删除"按钮，弹出确认删除对话框
   - 用户确认后，系统调用后端删除产线接口
   - 删除成功后，系统自动刷新产线列表并显示成功消息
   - 支持批量选择产线进行批量删除

6. **产线状态管理**：
   - 在创建和编辑产线时，支持选择产线状态（启用/禁用）
   - 产线列表中显示产线状态，使用不同颜色区分启用和禁用状态

##### 3.4.1.2.2 后端逻辑

1. **产线列表查询**：
   - 接收前端提交的查询参数，包括当前页码、每页大小、产线名称、产线编号、开始时间和结束时间
   - 根据查询参数构建查询条件
   - 按创建时间降序排序
   - 执行分页查询
   - 返回查询结果，包括产线列表和总记录数

2. **产线详情查询**：
   - 接收前端提交的产线ID
   - 根据产线ID查询产线详情
   - 如果产线不存在，返回错误信息
   - 返回产线详情信息

3. **产线创建**：
   - 接收前端提交的产线信息
   - 验证产线名称不能为空
   - 验证产线名称是否已存在
   - 生成新的产线ID
   - 设置创建时间和更新时间为当前时间
   - 保存产线信息到数据库
   - 返回创建结果

4. **产线编辑**：
   - 接收前端提交的产线信息
   - 验证产线名称不能为空
   - 验证产线名称是否已存在（排除当前产线）
   - 设置更新时间为当前时间
   - 更新产线信息到数据库
   - 返回更新结果

5. **产线删除**：
   - 接收前端提交的产线ID列表
   - 使用事务处理批量删除操作
   - 从数据库中删除指定的产线
   - 提交事务
   - 返回删除结果

6. **产线状态管理**：
   - 在创建和编辑产线时，接收前端提交的状态信息
   - 将状态信息保存到数据库
   - 产线列表查询时，返回产线状态信息

#### 3.4.1.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 产线列表查询接口 | `/api/ProductionLine/GetProductionLineList` | GET | 根据查询参数分页查询产线列表，支持产线名称、编号和时间区间搜索 |
| 产线详情查询接口 | `/api/ProductionLine/GetProductionLineById/{productionLineId}` | GET | 根据产线ID查询产线详情 |
| 产线创建接口 | `/api/ProductionLine/CreateProductionLine` | POST | 创建新的产线，包括产线名称、编号、状态和描述信息 |
| 产线更新接口 | `/api/ProductionLine/UpdateProductionLine` | POST | 更新产线信息，包括产线名称、编号、状态和描述信息 |
| 产线删除接口 | `/api/ProductionLine/DeleteProductionLineByIds` | POST | 批量删除产线，接收产线ID列表 |
| 所有产线查询接口 | `/api/ProductionLine/All` | GET | 查询所有产线列表，用于下拉选择等场景 |

### 3.4.2 设备管理

#### 3.4.2.1 功能概述

设备管理模块用于管理企业的生产设备信息，包括设备的创建、编辑、删除、查询和状态管理。该模块为企业提供了设备的全生命周期管理能力，有助于企业规范化设备管理流程，提高生产管理效率。

主要功能包括：
- 设备列表查询：支持分页查询、设备名称和编码搜索、时间区间搜索
- 设备详情查看：点击设备名称查看详细信息
- 设备创建：支持输入设备名称、编码、类型、制造商、所属生产线、工单编码、状态和描述信息
- 设备编辑：支持修改设备的各项信息
- 设备删除：支持单个删除和批量删除设备
- 设备状态管理：支持启用/禁用设备状态
- 批量修改工单编码：支持批量选择设备并修改其工单编码
- 设备监控跳转：点击设备名称跳转到设备监控页面

#### 3.4.2.2 模块逻辑

##### 3.4.2.2.1 前端逻辑

1. **设备列表查询**：
   - 用户进入设备管理页面，系统自动加载设备列表
   - 支持输入设备名称和编码进行搜索
   - 支持选择时间区间进行搜索
   - 支持分页查询，可调整每页显示数量

2. **设备详情查看**：
   - 点击设备操作列的"详情"按钮，从右侧滑出详情抽屉
   - 详情抽屉展示设备的完整信息
   - 支持关闭详情抽屉

3. **设备创建**：
   - 点击"新增设备"按钮，打开创建设备表单
   - 表单验证设备名称、编码、类型、制造商、所属生产线、工单编码和状态不能为空
   - 表单提交后，系统调用后端创建设备接口
   - 创建成功后，系统自动刷新设备列表并显示成功消息

4. **设备编辑**：
   - 点击设备操作列的"编辑"按钮，打开编辑设备表单
   - 表单自动填充当前设备的信息
   - 表单验证设备名称、编码、类型、制造商、所属生产线、工单编码和状态不能为空
   - 表单提交后，系统调用后端更新设备接口
   - 更新成功后，系统自动刷新设备列表并显示成功消息

5. **设备删除**：
   - 点击设备操作列的"删除"按钮，弹出确认删除对话框
   - 用户确认后，系统调用后端删除设备接口
   - 删除成功后，系统自动刷新设备列表并显示成功消息
   - 支持批量选择设备进行批量删除

6. **设备状态管理**：
   - 在创建和编辑设备时，支持选择设备状态（启用/禁用）
   - 设备列表中显示设备状态，使用不同颜色区分启用和禁用状态

7. **批量修改工单编码**：
   - 批量选择设备，点击"批量修改工单编码"按钮
   - 系统检查选中设备的工单编码是否一致
   - 如果一致，打开批量修改工单编码弹窗
   - 用户选择新的工单编码并提交
   - 系统调用后端更新设备接口，批量修改选中设备的工单编码
   - 修改成功后，系统自动刷新设备列表并显示成功消息

8. **设备监控跳转**：
   - 点击设备名称，系统检查设备是否有设备类型
   - 如果有，跳转到设备监控页面并传递设备类型参数
   - 如果没有，显示警告消息

##### 3.4.2.2.2 后端逻辑

1. **设备列表查询**：
   - 接收前端提交的查询参数，包括当前页码、每页大小、设备名称、设备编码、所属生产线ID、开始时间和结束时间
   - 根据查询参数构建查询条件
   - 执行分页查询
   - 返回查询结果，包括设备列表和总记录数

2. **设备详情查询**：
   - 接收前端提交的设备ID
   - 根据设备ID查询设备详情
   - 如果设备不存在，返回错误信息
   - 返回设备详情信息

3. **设备创建**：
   - 接收前端提交的设备信息
   - 验证设备名称、编码、类型、制造商、所属生产线、工单编码和状态不能为空
   - 生成新的设备ID
   - 设置创建时间和更新时间为当前时间
   - 保存设备信息到数据库
   - 返回创建结果

4. **设备编辑**：
   - 接收前端提交的设备信息
   - 验证设备名称、编码、类型、制造商、所属生产线、工单编码和状态不能为空
   - 设置更新时间为当前时间
   - 更新设备信息到数据库
   - 返回更新结果

5. **设备删除**：
   - 接收前端提交的设备ID列表
   - 从数据库中删除指定的设备
   - 返回删除结果

6. **设备状态管理**：
   - 在创建和编辑设备时，接收前端提交的状态信息
   - 将状态信息保存到数据库
   - 设备列表查询时，返回设备状态信息

7. **批量修改工单编码**：
   - 接收前端提交的设备ID列表和新的工单编码
   - 遍历设备ID列表，更新每个设备的工单编码
   - 返回修改结果

#### 3.4.2.3 使用的接口

| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 设备列表查询接口 | `/api/Deviceinfo/GetDeviceInfoList` | GET | 根据查询参数分页查询设备列表，支持设备名称、编码和时间区间搜索 |
| 设备详情查询接口 | `/api/Deviceinfo/GetDeviceInfoById/{deviceId}` | GET | 根据设备ID查询设备详情 |
| 设备创建接口 | `/api/Deviceinfo/CreateDeviceInfo` | POST | 创建新的设备，包括设备名称、编码、类型、制造商、所属生产线、工单编码、状态和描述信息 |
| 设备更新接口 | `/api/Deviceinfo/UpdateDeviceInfo` | POST | 更新设备信息，包括设备名称、编码、类型、制造商、所属生产线、工单编码、状态和描述信息 |
| 设备删除接口 | `/api/Deviceinfo/DeleteDeviceInfoByIds` | POST | 批量删除设备，接收设备ID列表 |
| 生产线列表查询接口 | `/api/ProductionLine/GetProductionLineList` | GET | 查询生产线列表，用于设备创建和编辑时选择所属生产线 |
| 工单列表查询接口 | `/api/OrderList/GetOrderList` | GET | 查询工单列表，用于设备创建、编辑和批量修改时选择工单编码 |


## 3.5 生产看板
### 3.5.1 功能概述
生产监控看板是一个实时可视化的生产数据监控系统，用于展示企业生产过程中的关键指标和数据。该模块为企业提供了直观的生产状态监控能力，有助于企业及时发现生产问题，优化生产流程，提高生产效率和产品质量。

主要功能包括：
- 小时产量与良率统计：显示24小时的产量和良率数据，使用柱状图和折线图直观展示
- 各站不良率分析：显示各站点的不良品数量和不良率，使用柱状图和折线图展示
- 一次性通过率：显示总产出和一次性通过的对比，使用柱状图展示
- 合格率分析：显示合格产品和不良产品的比例，使用饼图展示
- 车间实时OEE：显示各站点的NG件统计，使用饼图展示
- TOP10缺陷分析：显示排名前10的缺陷类型，使用饼图展示
- 当日设备时间损失Top5：显示排名前5的设备时间损失，使用表格展示
- 实时时间显示：页面顶部实时显示当前日期和时间
- 自动数据刷新：每5秒自动刷新所有数据，确保数据实时性
- 响应式布局：适配不同屏幕尺寸

### 3.5.2 模块逻辑
#### 3.5.2.1 前端逻辑
1. **页面初始化**：
   - 页面加载时，初始化所有图表组件（ECharts实例）
   - 设置图表的初始配置（标题、图例、提示框等）
   - 调用数据加载函数获取初始数据

2. **数据加载与处理**：
   - **时间范围处理**：根据是否为测试模式，获取当天或指定测试日期的时间范围
   - **小时产量数据**：调用`getHourlyOutput`函数获取小时产量数据，处理后更新图表
   - **各站NG件统计数据**：调用`getStationNGStatistics`函数获取各站NG件统计数据，处理后更新图表
   - **项目统计数据**：并行调用`calculateFirstPassYield`和`calculateQualityRate`函数获取一次通过率和合格率数据，处理后更新图表
   - **TOP缺陷分析数据**：调用`getTopDefects`函数获取TOP10缺陷分析数据，处理后更新图表
   - **产品完成生产数量数据**：调用`getFinishedProductCount`函数获取产品完成生产数量数据，处理后更新表格

3. **图表配置与更新**：
   - **小时产量与良率统计图表**：使用柱状图显示产量，折线图显示良率
   - **各站不良率分析图表**：使用柱状图显示不良品数量，折线图显示不良率
   - **一次性通过率图表**：使用柱状图显示总产出和一次性通过的对比
   - **合格率分析图表**：使用饼图显示合格产品和不良产品的比例
   - **车间实时OEE图表**：使用饼图显示各站点的NG件统计
   - **TOP10缺陷分析图表**：使用饼图显示排名前10的缺陷类型
   - **当日设备时间损失Top5表格**：使用表格显示排名前5的设备时间损失

4. **数据刷新**：
   - 设置5秒定时刷新所有数据
   - 调用`refreshAllData`函数刷新数据，不显示加载提示，实现静默刷新

5. **响应式处理**：
   - 监听窗口大小变化事件
   - 调用所有图表的`resize`方法，确保图表适配新的窗口大小

   #### 3.5.2.2 后端逻辑
1. **小时产量数据接口**：
   - 接收生产线ID、设备ID、开始时间和结束时间参数
   - 查询指定时间范围内的小时产量数据
   - 返回包含小时、产量、合格数量和不合格数量的数据

2. **各站NG件统计数据接口**：
   - 接收生产线ID、开始时间和结束时间参数
   - 查询指定时间范围内的各站NG件统计数据
   - 返回包含站点编码、站点名称、不良品数量和不良率的数据

3. **一次通过率数据接口**：
   - 接收生产线ID、开始时间和结束时间参数
   - 查询指定时间范围内的一次通过率数据
   - 返回包含总投入、一次性通过数量和一次通过率的数据

4. **合格率数据接口**：
   - 接收生产线ID、开始时间和结束时间参数
   - 查询指定时间范围内的合格率数据
   - 返回包含合格数量、不合格数量、合格率和不合格率的数据

5. **TOP缺陷分析数据接口**：
   - 接收生产线ID、开始时间、结束时间和TopN参数
   - 查询指定时间范围内的缺陷分析数据，按缺陷数量排序，返回前N个
   - 返回包含缺陷类型、缺陷数量和缺陷百分比的数据

6. **产品完成生产数量数据接口**：
   - 接收生产线ID、开始时间和结束时间参数
   - 查询指定时间范围内的产品完成生产数量数据
   - 返回包含产品名称、总完工数量和合格数量的数据

### 3.5.3 使用的接口
| 接口名称 | 接口路径 | 请求方法 | 功能描述 |
|--------|---------|---------|---------|
| 小时产量数据接口 | `/api/Report/HourlyOutput` | GET | 获取小时产量数据，包括小时、产量、合格数量和不合格数量 |
| 各站NG件统计数据接口 | `/api/Report/StationNGStatistics` | GET | 获取各站NG件统计数据，包括站点编码、站点名称、不良品数量和不良率 |
| 一次通过率数据接口 | `/api/Report/FirstPassYield` | GET | 获取一次通过率数据，包括总投入、一次性通过数量和一次通过率 |
| 合格率数据接口 | `/api/Report/QualityRate` | GET | 获取合格率数据，包括合格数量、不合格数量、合格率和不合格率 |
| TOP缺陷分析数据接口 | `/api/Report/TopDefects` | GET | 获取TOP缺陷分析数据，包括缺陷类型、缺陷数量和缺陷百分比 |
| 产品完成生产数量数据接口 | `/api/Report/FinishedProductCount` | GET | 获取产品完成生产数量数据，包括产品名称、总完工数量和合格数量 |

### 3.5.4 技术实现
#### 3.5.4.1 前端技术
- **核心框架**：HTML5 + JavaScript
- **图表库**：ECharts 5.0+
- **样式**：CSS3
- **数据请求**：Fetch API
- **响应式设计**：CSS Flexbox

#### 3.5.4.2 后端技术
- **核心框架**：ASP.NET Core Web API
- **数据访问**：Entity Framework Core
- **数据存储**：PostgreSQL


# 4 性能设计

# 5 数据库设计


# 6 接口设计（RESTful）
每个接口包含：URL、Method、请求/响应结构、错误码

## 6.1 生产管理
生产管理模块包含上料、跳站、返工等核心生产操作接口，用于控制和管理生产过程。

### 6.1.1 生产管理接口列表

| 接口名称 | 接口路径 | 请求方法 | 功能描述 | 权限要求 |
|--------|---------|---------|---------|---------|
| 物料上传接口 | `/api/CommonInterfase/FeedMaterial` | POST | 记录原材料批次的上料信息，实现物料批次与生产工单的关联 | 生产管理员/操作员 |
| 跳站接口 | `/api/CommonInterfase/JumpStation` | POST | 处理生产过程中的跳站操作，将产品从当前站点跳过到指定站点 | 生产管理员/操作员 |
| 返工接口 | `/api/CommonInterfase/ReWork` | POST | 处理生产过程中的返工操作，将产品从当前站点返回到指定站点 | 生产管理员/操作员 |

### 6.1.2 核心接口说明

#### 6.1.2.1 物料上传接口
- **业务逻辑**：
  - 接收前端提交的物料批次信息，包括批次号、设备编码、站点编码、工单编码、上料数量和产品编码
  - 验证设备是否存在且已绑定生产工单
  - 验证产品是否存在于系统中
  - 验证站点是否存在于系统中
  - 验证批次号是否符合BOM定义的规则（正则表达式）
  - 验证批次号是否已被使用
  - 验证批次号中提取的物料是否与请求的产品编码一致
  - 验证上料数量是否大于0
  - 如果BOM定义了保质期，自动计算批次过期时间
  - 将物料批次信息与生产工单关联并保存到数据库
  - 返回上料成功消息

#### 6.1.2.2 跳站接口
- **业务逻辑**：
  - 接收前端提交的产品序列号和目标跳站站点编码
  - 验证产品序列号是否存在于Current表中
  - 验证当前站点和跳站站点是否存在
  - 验证当前站点是否与跳站站点相同
  - 验证工单是否存在
  - 验证当前站点和跳站站点是否在工艺路线中存在
  - 验证当前站点顺序是否小于跳站站点顺序（确保跳站方向正确）
  - 更新产品的当前站点信息为跳站站点
  - 记录跳站操作日志
  - 返回跳站成功消息

#### 6.1.2.3 返工接口
- **业务逻辑**：
  - 接收前端提交的产品序列号、目标返工站点编码和可选的物料批次明细ID列表
  - 验证产品序列号是否存在于Current表中
  - 验证当前站点和返工站点是否存在
  - 验证当前站点是否与返工站点相同
  - 验证工单是否存在
  - 验证当前站点和返工站点是否在工艺路线中存在
  - 验证当前站点顺序是否大于返工站点顺序（确保返工方向正确）
  - 如果提供了解绑物料列表，解绑相应的物料批次
  - 更新产品的当前站点信息为返工站点
  - 记录返工操作日志
  - 返回返工成功消息

## 6.2 工单管理
工单管理模块提供了工单的增删改查、状态更新和统计等功能，支持生产工单和返工工单的全生命周期管理。

### 6.2.1 工单管理接口列表

| 接口名称 | 接口路径 | 请求方法 | 功能描述 | 权限要求 |
|--------|---------|---------|---------|---------|
| 分页查询工单列表接口 | `/api/OrderList/GetOrderListList` | GET | 查询工单列表，支持多种条件过滤和分页 | 生产管理员/操作员 |
| 根据ID获取工单详情接口 | `/api/OrderList/GetOrderListById` | GET | 根据工单ID获取工单的详细信息 | 生产管理员/操作员 |
| 根据工单编码获取工单详情接口 | `/api/OrderList/GetOrderListByCode` | GET | 根据工单编码获取工单的详细信息 | 生产管理员/操作员 |
| 创建工单接口 | `/api/OrderList/CreateOrderList` | POST | 创建新的工单 | 生产管理员 |
| 更新工单接口 | `/api/OrderList/UpdateOrderListById` | POST | 更新工单的信息 | 生产管理员 |
| 删除工单接口 | `/api/OrderList/DeleteOrderListByIds` | POST | 删除工单，支持单个删除和批量删除 | 生产管理员 |
| 更新工单状态接口 | `/api/OrderList/UpdateOrderStatus` | POST | 更新工单的状态 | 生产管理员/操作员 |
| 获取工单统计信息接口 | `/api/OrderList/GetOrderStatistics` | GET | 获取工单的统计信息，如各状态工单的数量 | 生产管理员/操作员 |

### 6.2.2 核心接口说明

#### 6.2.2.1 分页查询工单列表接口
- **业务逻辑**：
  - 接收前端提交的查询参数，包括工单ID、工单编码、工单名称、产品ID等过滤条件和分页参数
  - 验证分页参数（PageIndex ≥ 1，PageSize 1-100）
  - 根据过滤条件构建数据库查询
  - 执行分页查询获取工单列表
  - 封装查询结果并返回

#### 6.2.2.2 根据ID获取工单详情接口
- **业务逻辑**：
  - 接收前端提交的工单ID参数
  - 验证工单ID是否为有效的GUID格式
  - 根据工单ID从数据库中查询工单详情
  - 返回查询到的工单信息

#### 6.2.2.3 根据工单编码获取工单详情接口
- **业务逻辑**：
  - 接收前端提交的工单编码参数
  - 验证工单编码是否为空
  - 根据工单编码从数据库中查询工单详情
  - 返回查询到的工单信息

#### 6.2.2.4 创建工单接口
- **业务逻辑**：
  - 接收前端提交的工单创建信息，包括工单编码、工单名称、产品ID等
  - 验证必填参数（工单编码、工单名称、产品ID）是否为空
  - 验证工单编码是否已存在
  - 创建新的工单记录
  - 返回创建成功的工单信息

#### 6.2.2.5 更新工单接口
- **业务逻辑**：
  - 接收前端提交的工单ID和更新信息
  - 验证URL中的ID与请求体中的ID是否匹配
  - 验证必填参数是否为空
  - 查询工单是否存在
  - 更新工单信息
  - 返回更新后的工单信息

#### 6.2.2.6 删除工单接口
- **业务逻辑**：
  - 接收前端提交的工单ID列表
  - 验证ID列表是否为空
  - 查询所有要删除的工单是否存在
  - 删除对应的工单记录
  - 返回删除结果

#### 6.2.2.7 更新工单状态接口
- **业务逻辑**：
  - 接收前端提交的工单ID和新状态
  - 验证工单ID和新状态是否为空
  - 验证新状态是否为有效的状态值
  - 查询工单是否存在
  - 更新工单状态
  - 返回更新后的工单信息

#### 6.2.2.8 获取工单统计信息接口
- **业务逻辑**：
  - 接收前端请求
  - 统计各状态工单的数量
  - 返回统计结果


# 7 系统出错处理设计
## 7.1 出错信息
返回结构：{ code, message, traceId }
日志记录：关键操作、异常堆栈
## 7.2 补救措施
重试机制（如网络超时）
数据回滚（事务保证）
## 7.3 系统维护设计
健康检查接口 /health
日志集中采集（如 ELK）
# 8 系统处理规定
## 8.1 输入输出要求
所有时间格式：ISO 8601（如 "2026-01-19T10:00:00Z"）
数值精度：保留2位小数（如金额）
## 8.2 数据管理能力要求
单表支持 ≥ 1000 万条记录（通过索引优化）
## 8.3 故障处理要求
数据库主从切换 ≤ 30s
服务无单点故障
## 8.4 其他专门要求
审计日志：记录关键数据变更（谁、何时、改了什么）
附录（可选）
A. 术语表
B. 接口错误码清单
C. 数据库ER图（或表结构DDL）