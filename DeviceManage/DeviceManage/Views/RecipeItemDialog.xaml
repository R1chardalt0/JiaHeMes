<UserControl x:Class="DeviceManage.Views.RecipeItemDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignHeight="400" d:DesignWidth="600">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <!-- 整个对话框 -->
    <Border Background="#80000000"
            Visibility="{Binding IsDialogOpen.Value, Converter={StaticResource BooleanToVisibilityConverter}}">
        <Border Width="600" Background="White" CornerRadius="8" Padding="20" HorizontalAlignment="Center" VerticalAlignment="Center">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 标题 -->
                <TextBlock Text="配方项管理" FontSize="16" FontWeight="Bold"/>

                <!-- 列表 + 表单 -->
                <Grid Grid.Row="1" Margin="0,10,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左侧列表 -->
                    <DataGrid ItemsSource="{Binding Items.Value}" CanUserAddRows="False" AutoGenerateColumns="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="TagId" Binding="{Binding TagId}" Width="60"/>
                            <DataGridTextColumn Header="TagKey" Binding="{Binding TagKey}" Width="*"/>
                            <DataGridTextColumn Header="目标值" Binding="{Binding TargetValue}" Width="*"/>
                            <DataGridTemplateColumn Header="操作" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="编辑" Style="{StaticResource ButtonDashedSuccess}" Margin="0,0,10,0"
                                                    Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"/>
                                            <Button Content="删除" Style="{StaticResource ButtonDashedDanger}"
                                                    Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- 右侧表单 -->
                    <StackPanel Grid.Column="1" Margin="15,0,0,0">
                        <Label Content="Tag:"/>
                        <ComboBox ItemsSource="{Binding AllTags.Value}" DisplayMemberPath="Id" SelectedValuePath="Id"
                                  SelectedValue="{Binding EditingItem.Value.TagId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  SelectionChanged="ComboBox_SelectionChanged"/>
                        <Label Content="TagKey:" Margin="0,10,0,0"/>
                        <ComboBox ItemsSource="{Binding CurrentTagKeys.Value}"
                                  SelectedItem="{Binding EditingItem.Value.TagKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        <Label Content="目标值:" Margin="0,10,0,0"/>
                        <TextBox Text="{Binding EditingItem.Value.TargetValue, UpdateSourceTrigger=PropertyChanged}"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                            <Button Content="取消" Command="{Binding CancelCommand}" Style="{StaticResource ButtonDanger}" Margin="0,0,10,0"/>
                            <Button Content="保存" Command="{Binding SaveCommand}" Style="{StaticResource ButtonInfo}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- 顶部新增按钮 -->
                <Button Grid.Row="2" Content="新增配方项" HorizontalAlignment="Left" Command="{Binding AddCommand}" Style="{StaticResource ButtonDashedSuccess}"/>
            </Grid>
        </Border>
    </Border>
</UserControl>
