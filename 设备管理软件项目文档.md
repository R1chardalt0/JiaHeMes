## 项目概述
DeviceManage 是一个基于 WPF 开发的设备管理软件，主要用于工业环境中的 PLC 设备管理、配方管理、点位管理等功能。该项目采用 MVVM 架构模式，结合了现代化的 UI 设计和完善的业务逻辑处理。

## 技术栈
- 开发语言 ：C#
- 前端框架 ：WPF (Windows Presentation Foundation)
- UI 库 ：HandyControl
- 架构模式 ：MVVM (Model-View-ViewModel)
- 响应式编程 ：ReactiveUI (ReactiveProperty)
- 数据库 ：PostgreSQL
- ORM 框架 ：Entity Framework Core
- 依赖注入 ：Microsoft.Extensions.DependencyInjection
- 日志 ：log4net

## 项目结构
项目采用清晰的分层架构，主要目录结构如下：
DeviceManage/
├── Commands/          # 命令相关类
├── Controls/          # 自定义控件基类
├── Converters/        # 各种值转换器
├── CustomerControl/   # 自定义控件
├── DBContext/         # 数据库上下文和仓库模式
├── Helpers/           # 辅助类
├── Models/            # 数据模型
├── Resources/         # 资源文件
├── Services/          # 服务实现
├── Styles/            # 样式文件
├── ViewModels/        # 视图模型
├── Views/             # 视图
└── App.xaml           # 应用入口

## 核心功能模块
1. 仪表盘 (Dashboard) ：系统概览和关键指标展示
2. PLC 设备管理 ：管理 PLC 设备的连接和配置
3. 配方管理 ：管理生产配方和参数设置
4. 点位管理 ：管理设备点位信息
5. 设备状态 ：实时监控设备运行状态
6. 配置管理 ：系统配置参数管理
7. 系统设置 ：系统级别的设置和配置
8. 日志管理 ：操作日志和系统日志管理
9. 用户管理 ：用户账户和权限管理
## 系统配置
系统配置通过 appsettings.json 文件进行管理，主要配置项包括：

- API 设置 ：基础 URL 和超时时间
- 数据库连接 ：PostgreSQL 连接字符串
- 空闲检测 ：是否启用自动关闭和超时时间
- 日志级别 ：系统日志记录级别
## 系统流程
1. 启动流程 ：
   
   - 检查是否已有实例运行
   - 加载配置文件
   - 配置依赖注入
   - 初始化数据库
   - 启动空闲检测服务
   - 显示登录窗口
2. 登录流程 ：
   
   - 用户输入用户名和密码
   - 验证用户身份
   - 登录成功后显示主窗口
3. 主窗口流程 ：
   
   - 默认加载仪表盘
   - 提供侧边栏导航
   - 支持页面切换
   - 提供用户信息展示
   - 支持退出登录
## 数据库设计
系统使用 PostgreSQL 数据库，主要模型包括：

- User ：用户信息
- PlcDevice ：PLC 设备信息
- Tag ：点位信息
- Recipe ：配方信息
- OperationLog ：操作日志
## 特色功能
1. 空闲检测 ：系统会在设定的空闲时间后自动关闭，提高安全性
2. 单实例运行 ：确保系统只运行一个实例，避免冲突
3. 现代化 UI ：使用 HandyControl 库提供美观的用户界面
4. 响应式编程 ：使用 ReactiveProperty 实现响应式 UI 更新
5. 依赖注入 ：使用 Microsoft.Extensions.DependencyInjection 实现服务的解耦和管理
6. 仓库模式 ：使用仓库模式封装数据访问逻辑
## 总结
DeviceManage 是一个功能完善、架构清晰的设备管理软件，采用现代化的技术栈和设计模式，适合用于工业环境中的设备管理和监控。该项目不仅实现了基本的设备管理功能，还提供了配方管理、点位管理等专业功能，为工业生产提供了有力的支持。

项目的模块化设计和清晰的代码结构，使得系统易于维护和扩展，能够根据实际需求进行定制和功能增强。


MVVM 实践
你在项目中如何划分 Model、View 和 ViewModel 的职责？能否举例说明某个功能（如配方编辑）的 MVVM 实现流程？
如何处理 View 与 ViewModel 之间的复杂交互（例如拖拽点位、动态表单）？是否使用了行为（Behaviors）或自定义控件？
PLC 通信设计
软件通过什么协议与 PLC 通信（如 Modbus TCP、S7）？通信模块是否独立封装？如何管理多设备并发连接与异常重连？
数据读写是同步还是异步？如何避免 UI 线程阻塞？
数据管理与状态同步
配方和点位数据存储在本地还是数据库？若需离线操作，如何保证数据一致性？
当多个用户同时修改同一配方时，系统如何处理冲突？
性能与可靠性
工业现场可能网络不稳定，你的软件如何保障关键操作（如紧急停机指令）的可靠送达？
是否做过内存泄漏或长时间运行的压力测试？发现过哪些典型问题？
工程化细节
项目是否采用依赖注入（如 Prism 或 Unity）？如何管理模块间的解耦？
日志和错误监控机制是如何设计的？能否快速定位现场故障？


## 整体C/S拓扑图
┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
│                 │          │                 │          │                 │
│   WPF 客户端    │◄───────►│  通信中间件/服务  │◄───────►│    PLC 设备     │
│                 │  TCP/IP  │                 │  工业协议 │                 │
└─────────────────┘          └─────────────────┘          └─────────────────┘
       ▲                            ▲                            ▲
       │                            │                            │
       ▼                            ▼                            ▼
┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
│                 │          │                 │          │                 │
│  本地数据库存储   │          │  配置管理服务    │          │  设备点位管理     │
│                 │          │                 │          │                 │
└─────────────────┘          └─────────────────┘          └─────────────────┘