<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <title>ç”Ÿäº§ç›‘æ§çœ‹æ¿</title>
    <link rel="stylesheet" href="css/app.css" />
    <style>
        .stats-grid {
            display: flex;
            justify-content: space-between;
            height: 100%;
        }

        .stats-item {
            flex: 1;
            margin: 0 5px;
        }

        /* äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åè¡¨æ ¼æ ·å¼ */
        .finished-product-table {
            width: 100%;
            border-collapse: collapse;
        }

        .finished-product-table th,
        .finished-product-table td {
            text-align: center;
            padding: 8px;
            border: 1px solid #ddd;
            color: #5dc2fe;
        }

        .finished-product-table th {
            background-color: rgba(24, 144, 255, 0.1);
            font-weight: bold;
        }

        .finished-product-table tr:nth-child(even) {
            background-color: rgba(24, 144, 255, 0.05);
        }
    </style>
    <script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/jdjh.js"></script>
    <script type="text/javascript">
        function getCurDate() {
            var d = new Date();
            var week;
            switch (d.getDay()) {
                case 1:
                    week = "æ˜ŸæœŸä¸€";
                    break;
                case 2:
                    week = "æ˜ŸæœŸäºŒ";
                    break;
                case 3:
                    week = "æ˜ŸæœŸä¸‰";
                    break;
                case 4:
                    week = "æ˜ŸæœŸå››";
                    break;
                case 5:
                    week = "æ˜ŸæœŸäº”";
                    break;
                case 6:
                    week = "æ˜ŸæœŸå…­";
                    break;
                default:
                    week = "æ˜ŸæœŸå¤©";
            }
            var years = d.getFullYear();
            var month = add_zero(d.getMonth() + 1);
            var days = add_zero(d.getDate());
            var hours = add_zero(d.getHours());
            var minutes = add_zero(d.getMinutes());
            var seconds = add_zero(d.getSeconds());
            var ndate = years + "å¹´" + month + "æœˆ" + days + "æ—¥ " + hours + ":"
                + minutes + ":" + seconds + " " + week;
            var divT = document.getElementById("logInfo");
            divT.innerHTML = ndate;
        }
        function add_zero(temp) {
            if (temp < 10)
                return "0" + temp;
            else
                return temp;
        }
        setInterval("getCurDate()", 100);
    </script>
</head>

<body class="bg01">
    <div class="header">
        <h1 class="header-title">ç”Ÿäº§ç›‘æ§çœ‹æ¿</h1>
        <div id="logInfo" style="text-align: left;color: #fff;position: relative;left: 10px;">
            <script type="text/JavaScript" language="JavaScript">
			getCurDate();
		</script>
        </div>
    </div>
    <div class="wrapper">
        <div class="content">
            <div class="col col-l">
                <div class="xpanel-wrapper xpanel-wrapper-25">
                    <div class="xpanel xpanel-l-t">
                        <div class="title">ä¸€æ¬¡æ€§é€šè¿‡ç‡</div>
                        <div id="outputCompareChart" class="bcontent">

                        </div>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-25">
                    <div class="xpanel xpanel-l-m">
                        <div class="title">åˆæ ¼ç‡åˆ†æ</div>
                        <div id="wzCharts" class="bcontent">

                        </div>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-45">
                    <div class="xpanel xpanel-l-b">
                        <div class="title">å„ç«™NGä»¶ç»Ÿè®¡</div>
                        <div id="ryCharts" class="bcontent">

                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-c">
                <div class="xpanel-wrapper xpanel-wrapper-55">
                    <div class="xpanel xpanel-c-b">
                        <div class="title title-long" style="padding-left:25px">å°æ—¶äº§é‡ä¸è‰¯ç‡ç»Ÿè®¡</div>
                        <div id="container" class="bcontent" style="height:85%;">

                        </div>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-45">
                    <div class="xpanel xpanel-c-b">
                        <div class="title title-long" style="padding-left:25px">å„ç«™ä¸è‰¯ç‡åˆ†æ</div>
                        <div id="gCharts" class="bcontent" style="height:92%;">

                        </div>
                    </div>

                </div>
            </div>
            <div class="col col-r">
                <div class="xpanel-wrapper xpanel-wrapper-55">
                    <div class="xpanel xpanel-r-t">
                        <div class="title">TOP10ç¼ºé™·åˆ†æ</div>
                        <div class="bcontent">
                            <div id="topDefectsChart" class="bcontent" style="height: 90%;"></div>
                        </div>
                    </div>
                </div>
                <div class="xpanel-wrapper xpanel-wrapper-45">
                    <div class="xpanel xpanel-r-b">
                        <div class="title">äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’å</div>
                        <div id="finishedProductList" class="bcontent">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
    // æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
    function formatDateTime(date) {
        if (!date) return '';
        var year = date.getFullYear();
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var day = String(date.getDate()).padStart(2, '0');
        var hours = String(date.getHours()).padStart(2, '0');
        var minutes = String(date.getMinutes()).padStart(2, '0');
        var seconds = String(date.getSeconds()).padStart(2, '0');
        return year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;
    }

    // è·å–å½“å‰æ—¥æœŸçš„å¼€å§‹å’Œç»“æŸæ—¶é—´
    function getTodayRange() {
        var now = new Date();
        var start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
        var end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
        return { start: start, end: end };
    }

    // è·å–æµ‹è¯•æ—¥æœŸçš„å¼€å§‹å’Œç»“æŸæ—¶é—´ (2026.1.15)
    function getTestRange() {
        var start = new Date(2026, 0, 15, 0, 0, 0);
        var end = new Date(2026, 0, 15, 23, 59, 59);
        return { start: start, end: end };
    }

    // å¤„ç†å°æ—¶äº§é‡æ•°æ® 
    function processHourlyData(data) {
        if (!data || !Array.isArray(data)) return [];
        return data.map(function (item) {
            if (item.hour === undefined || item.hour === null) {
                console.warn('ç¼ºå¤±Hourå­—æ®µ:', item);
                return null;
            }
            var hour = String(item.hour).padStart(2, '0');
            var totalCount = item.outputQuantity || 0;
            var okCount = item.passQuantity || 0;
            var ngCount = item.failQuantity || 0;
            // å…³é”®ä¿®å¤ï¼šä¿æŒä¸ºæ•°å€¼ï¼Œä¸è¦è½¬å­—ç¬¦ä¸²
            var yieldRate = totalCount === 0 ? 0 : (okCount / totalCount * 100); // â† ä¸è¦ .toFixed()
            return {
                timeLabel: hour + ':00',
                totalCount: totalCount,
                okCount: okCount,
                ngCount: ngCount,
                yieldRate: yieldRate // æ•°å€¼ç±»å‹
            };
        }).filter(Boolean);
    }

    // è·å–å°æ—¶äº§é‡æ•°æ®
    function getHourlyOutput(selectedProductionLine, selectedEquipment, startDate, endDate) {
        console.log('è°ƒç”¨getHourlyOutputæ¥å£ï¼Œå‚æ•°:', { selectedProductionLine, selectedEquipment, startDate, endDate });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (selectedEquipment) params.append('resourceId', selectedEquipment);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/HourlyOutput?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('getHourlyOutputå“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    // å¦‚æœæ¥å£è°ƒç”¨å¤±è´¥ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('getHourlyOutputå“åº”æ•°æ®:', data);
                return data.data || [];
            });
    }

    // è·å–å„ç«™NGä»¶ç»Ÿè®¡æ•°æ®
    function getStationNGStatistics(startDate, endDate, selectedProductionLine) {
        console.log('è°ƒç”¨getStationNGStatisticsæ¥å£ï¼Œå‚æ•°:', { startDate, endDate, selectedProductionLine });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/StationNGStatistics?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('getStationNGStatisticså“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    // å¦‚æœæ¥å£è°ƒç”¨å¤±è´¥ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('getStationNGStatisticså“åº”æ•°æ®:', data);
                return data.data || [];
            });
    }

    // è·å–ä¸€æ¬¡é€šè¿‡ç‡
    function calculateFirstPassYield(startDate, endDate, selectedProductionLine) {
        console.log('è°ƒç”¨calculateFirstPassYieldæ¥å£ï¼Œå‚æ•°:', { startDate, endDate, selectedProductionLine });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        // ä½¿ç”¨ä¸å…¶ä»–æ¥å£ä¸€è‡´çš„URLæ ¼å¼
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/FirstPassYield?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('calculateFirstPassYieldå“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    // å¦‚æœæ¥å£è°ƒç”¨å¤±è´¥ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('calculateFirstPassYieldå“åº”æ•°æ®:', data);
                // è¿”å›å®Œæ•´çš„æ•°æ®å¯¹è±¡ï¼ŒåŒ…å«totalInputã€firstPassCountå’ŒfirstPassYield
                return data.data;
            });
    }

    // è·å–åˆæ ¼ç‡
    function calculateQualityRate(startDate, endDate, selectedProductionLine) {
        console.log('è°ƒç”¨calculateQualityRateæ¥å£ï¼Œå‚æ•°:', { startDate, endDate, selectedProductionLine });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        // ä½¿ç”¨ä¸å…¶ä»–æ¥å£ä¸€è‡´çš„URLæ ¼å¼
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/QualityRate?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('calculateQualityRateå“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    // å¦‚æœæ¥å£è°ƒç”¨å¤±è´¥ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('calculateQualityRateå“åº”æ•°æ®:', data);
                // è¿”å›å®Œæ•´çš„qualityRateæ•°æ®å¯¹è±¡ï¼Œä¸éœ€è¦å‰ç«¯é¢å¤–è®¡ç®—
                return data.data;
            });
    }

    // è®¡ç®—æ€»äº§å‡º
    function calculateTotalOutput(startDate, endDate, selectedProductionLine) {
        console.log('è°ƒç”¨calculateTotalOutputå‡½æ•°ï¼Œå‚æ•°:', { startDate, endDate, selectedProductionLine });
        return getHourlyOutput('', '', startDate, endDate)
            .then(function (data) {
                console.log('getHourlyOutputè¿”å›æ•°æ®:', data);
                if (!data || !Array.isArray(data)) return 0;
                var total = data.reduce(function (sum, item) {
                    return sum + (item.outputQuantity || 0);
                }, 0);
                console.log('è®¡ç®—å¾—åˆ°æ€»äº§å‡º:', total);
                return total;
            });
    }

    // è·å–TOPç¼ºé™·åˆ†ææ•°æ®
    function getTopDefects(startDate, endDate, topN = 10, selectedProductionLine) {
        console.log('è°ƒç”¨getTopDefectsæ¥å£ï¼Œå‚æ•°:', { startDate, endDate, topN, selectedProductionLine });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        params.append('topN', topN);
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/TopDefects?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('getTopDefectså“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('getTopDefectså“åº”æ•°æ®:', data);
                return data.data || [];
            });
    }

    // è·å–äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ•°æ®
    function getFinishedProductCount(startDate, endDate, selectedProductionLine) {
        console.log('è°ƒç”¨getFinishedProductCountæ¥å£ï¼Œå‚æ•°:', { startDate, endDate, selectedProductionLine });
        var params = new URLSearchParams();
        if (selectedProductionLine) params.append('productionLineId', selectedProductionLine);
        if (startDate) params.append('startTime', startDate);
        if (endDate) params.append('endTime', endDate);
        // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
        params.append('t', Date.now());
        var apiUrl = 'http://localhost:8000/api/Report/FinishedProductCount?' + params.toString();
        console.log('è°ƒç”¨çš„API URL:', apiUrl);
        return fetch(apiUrl, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(function (response) {
                console.log('getFinishedProductCountå“åº”çŠ¶æ€:', response.status, response.statusText);
                if (!response.ok) {
                    console.error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :', response.status);
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯ï¼ŒçŠ¶æ€ç :' + response.status);
                }
                return response.json();
            })
            .then(function (data) {
                console.log('getFinishedProductCountå“åº”æ•°æ®:', data);
                return data.data || [];
            });
    }

    // å¤„ç†TOPç¼ºé™·æ•°æ®
    function processTopDefectsData(data) {
        if (!data || !Array.isArray(data)) return [];
        return data.map(function (item) {
            if (!item.defectType || item.defectCount === undefined || item.defectCount === null) {
                console.warn('ç¼ºå¤±ç¼ºé™·æ•°æ®:', item);
                return null;
            }
            return {
                name: item.defectType,
                value: item.defectCount,
                percentage: Number((item.defectPercentage * 100).toPrecision(3)), // è½¬æ¢ä¸ºç™¾åˆ†æ¯”ï¼Œä¿ç•™3ä½æœ‰æ•ˆæ•°å­—
                cumulativePercentage: Number((item.cumulativePercentage * 100).toPrecision(3)) // è½¬æ¢ä¸ºç™¾åˆ†æ¯”ï¼Œä¿ç•™3ä½æœ‰æ•ˆæ•°å­—
            };
        }).filter(Boolean);
    }

    // å¤„ç†å„ç«™NGä»¶ç»Ÿè®¡æ•°æ®
    function processStationNGData(data) {
        if (!data || !Array.isArray(data)) return [];

        // è¿‡æ»¤å‡ºæœ‰æ•ˆæ•°æ®
        var validData = data
            .map(function (item) {
                if (!item.stationName || item.ngCount === undefined || item.ngCount === null) {
                    console.warn('ç¼ºå¤±ç«™ç‚¹NGæ•°æ®:', item);
                    return null;
                }
                return {
                    station: item.stationName,
                    stationCode: item.stationCode, // ä¿ç•™åŸå§‹çš„ç«™ç‚¹ç¼–ç 
                    ngCount: item.ngCount || 0, // ä¿ç•™åŸå§‹çš„ä¸è‰¯å“æ•°é‡
                    value: item.ngCount || 0,
                    ngRate: item.ngRate || 0, // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„ä¸è‰¯ç‡ï¼ˆå°æ•°å½¢å¼ï¼‰
                    rate: item.ngRate || 0 // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„ä¸è‰¯ç‡ï¼ˆå°æ•°å½¢å¼ï¼‰
                };
            })
            .filter(Boolean);

        // è®¡ç®—æ€»NGæ•°é‡
        var totalNGCount = validData.reduce(function (sum, item) {
            return sum + item.value;
        }, 0);

        // æ·»åŠ ç™¾åˆ†æ¯”å­—æ®µ
        return validData.map(function (item) {
            return {
                ...item,
                percentage: totalNGCount > 0 ? (item.value / totalNGCount) * 100 : 0,
                name: item.station // ç”¨äºEChartsçš„nameå­—æ®µ
            };
        });
    }

    // åˆå§‹åŒ–å›¾è¡¨æ•°æ®
    var hourlyChartData = [];
    var stationNGChartData = [];
    var topDefectsChartData = [];
    var isTestMode = true;

    // åŠ è½½æ•°æ®å¹¶åˆå§‹åŒ–å›¾è¡¨
    function loadChartData() {
        var dateRange = isTestMode ? getTestRange() : getTodayRange();
        var startDate = formatDateTime(dateRange.start);
        var endDate = formatDateTime(dateRange.end);

        // è·å–å°æ—¶äº§é‡æ•°æ®
        getHourlyOutput('', '', startDate, endDate)
            .then(function (data) {
                hourlyChartData = processHourlyData(data);
                updateChart();
            })
            .catch(function (error) {
                console.error('è·å–å°æ—¶äº§é‡æ•°æ®å¤±è´¥:', error);
                hourlyChartData = [];
                updateChart();
            });

        // è·å–TOPç¼ºé™·æ•°æ®
        getTopDefects(startDate, endDate, 10, '')
            .then(function (data) {
                topDefectsChartData = processTopDefectsData(data);
                updateTopDefectsChart();
            })
            .catch(function (error) {
                console.error('è·å–TOPç¼ºé™·æ•°æ®å¤±è´¥:', error);
                topDefectsChartData = [];
                updateTopDefectsChart();
            });
    }

    function updateChart() {
        if (myChart) {
            // ç”Ÿæˆå®Œæ•´çš„24å°æ—¶æ—¶é—´æ ‡ç­¾æ•°ç»„
            var fullTimeLabels = [];
            for (var i = 0; i < 24; i++) {
                fullTimeLabels.push(String(i).padStart(2, '0') + ':00');
            }

            // å°†åç«¯è¿”å›çš„æ•°æ®è½¬æ¢ä¸ºä»¥æ—¶é—´æ ‡ç­¾ä¸ºé”®çš„å¯¹è±¡
            var dataMap = {};
            hourlyChartData.forEach(function (item) {
                dataMap[item.timeLabel] = item;
            });

            // åˆå¹¶å®Œæ•´æ—¶é—´æ ‡ç­¾å’Œå®é™…æ•°æ®ï¼Œä¸ºæ²¡æœ‰æ•°æ®çš„æ—¶é—´ç‚¹ä½¿ç”¨é»˜è®¤å€¼
            var mergedData = fullTimeLabels.map(function (timeLabel) {
                var item = dataMap[timeLabel] || {};
                return {
                    timeLabel: timeLabel,
                    totalCount: item.totalCount || 0,
                    yieldRate: item.yieldRate || 0
                };
            });

            myChart.setOption({
                xAxis: {
                    data: mergedData.map(item => item.timeLabel)
                },
                series: [
                    {
                        data: mergedData.map(item => item.totalCount)
                        // æŸ±çŠ¶å›¾é¢œè‰²ç”±åˆå§‹ option æ§åˆ¶ï¼Œå¯ä¸å†™
                    },
                    {
                        data: mergedData.map(item => item.yieldRate),
                        // ğŸ‘‡ å¿…é¡»å¸¦ä¸Šè¿™äº›ï¼Œå¦åˆ™æ ·å¼ä¸¢å¤±ï¼
                        lineStyle: { normal: { color: '#FFCC00' } },
                        itemStyle: { normal: { color: '#FFCC00' } },
                        label: { normal: { show: true, color: '#FFCC00', fontSize: 10, formatter: function (params) { return Number(params.value).toPrecision(3) + '%'; } } }
                    }
                ]
            });

            // æ•°æ®æ›´æ–°åè°ƒç”¨resizeæ–¹æ³•ï¼Œç¡®ä¿å›¾è¡¨å æ»¡å®¹å™¨å®½åº¦
            myChart.resize();
        }
    }

    // åˆå§‹åŒ–å°æ—¶äº§é‡ç»Ÿè®¡å›¾è¡¨ âœ… å®Œæ•´ç‰ˆ æŸ±çŠ¶å›¾+é»„è‰²æŠ˜çº¿å›¾+tooltipæ—¶é—´æ®µ+è‰¯ç‡
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    var option = {
        title: { text: 'å°æ—¶äº§é‡ç»Ÿè®¡', show: false },
        tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            formatter: function (params) {
                if (!params || params.length == 0) return "";
                var curTime = params[0].name;
                var hour = parseInt(curTime.split(":")[0]);
                var nextHour = hour + 1 === 24 ? 0 : hour + 1;
                var hourStr = String(hour).padStart(2, '0');
                var nextHourStr = String(nextHour).padStart(2, '0');
                var timePeriod = hourStr + ":00-" + nextHourStr + ":00";

                const curItem = hourlyChartData.find(item => item.timeLabel == curTime);
                var total = curItem ? curItem.totalCount : 0;
                var ok = curItem ? curItem.okCount : 0;
                var ng = curItem ? curItem.ngCount : 0;
                var rate = curItem ? curItem.yieldRate : 0;
                // å¯¹è‰¯ç‡è¿›è¡Œæ ¼å¼åŒ–ï¼Œæ˜¾ç¤ºä¸€ä½å°æ•°
                var formattedRate = rate.toFixed(1);

                var res = 'æ—¶é—´æ®µï¼š' + timePeriod;
                res += '<br/>æ€»äº§é‡: ' + total;
                res += '<br/>åˆæ ¼æ•°é‡: ' + ok;
                res += '<br/>ä¸åˆæ ¼æ•°é‡: ' + ng;
                res += '<br/>è‰¯ç‡: ' + formattedRate + '%';
                return res;
            }
        },
        xAxis: {
            type: 'category',
            data: [],
            axisLabel: { color: '#1890ff', fontSize: 12 },
            axisLine: { lineStyle: { color: '#1890ff' } },
            splitLine: { show: false }
        },
        yAxis: [
            {
                type: 'value',
                name: 'äº§å“æ•°é‡',
                nameTextStyle: { color: '#1890ff', fontSize: 12, fontWeight: 'bold' },
                axisLabel: { color: '#1890ff', fontSize: 12 },
                axisLine: { lineStyle: { color: '#1890ff' } },
                splitLine: { lineStyle: { color: 'rgba(24,144,255,0.1)' } },
                min: 0
            },
            {
                type: 'value',
                name: 'è‰¯ç‡(%)',
                nameTextStyle: { color: '#FFCC00', fontSize: 12, fontWeight: 'bold' },
                axisLabel: { color: '#FFCC00', fontSize: 12, formatter: '{value} %' },
                axisLine: { lineStyle: { color: '#FFCC00' } },
                splitLine: { show: false },
                min: 80,
                max: 100,
                position: 'right'
            }
        ],
        series: [
            {
                name: 'æ€»äº§é‡',
                type: 'bar',
                yAxisIndex: 0,
                data: [],
                itemStyle: {
                    normal: {
                        color: '#1890ff',
                        borderRadius: [10, 10, 0, 0]
                    }
                },
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#1890ff',
                        fontSize: 12,
                        fontWeight: 'bold'
                    }
                },
                animation: true,
                animationDuration: 1000
            },
            {
                name: 'è‰¯ç‡',
                type: 'line',
                yAxisIndex: 1,
                data: [],
                symbol: 'circle',
                symbolSize: 6,
                smooth: true,
                // ğŸ‘‡ å…³é”®ä¿®æ”¹ï¼šåŒ…è£¹åœ¨ normal ä¸­
                lineStyle: {
                    normal: {
                        color: '#FFCC00',
                        width: 2
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#FFCC00'
                    }
                },
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#FFCC00',
                        fontSize: 10,
                        formatter: function (params) {
                            // ä¿ç•™3ä½æœ‰æ•ˆæ•°å­—
                            return Number(params.value).toPrecision(3) + '%';
                        }
                    }
                },
                animation: true,
                animationDuration: 1000
            }
        ]
    };

    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }

    // åŠ è½½å„ç«™NGä»¶ç»Ÿè®¡æ•°æ®
    function loadStationNGData() {
        console.log('è°ƒç”¨loadStationNGDataå‡½æ•°');
        var dateRange = isTestMode ? getTestRange() : getTodayRange();
        var startDate = formatDateTime(dateRange.start);
        var endDate = formatDateTime(dateRange.end);
        console.log('æ—¶é—´èŒƒå›´:', startDate, '-', endDate);
        getStationNGStatistics(startDate, endDate, '')
            .then(function (data) {
                console.log('getStationNGStatisticsè¿”å›æ•°æ®:', data);
                stationNGChartData = processStationNGData(data);
                console.log('å¤„ç†åçš„å„ç«™NGä»¶ç»Ÿè®¡æ•°æ®:', stationNGChartData);
                updateStationNGChart();
            })
            .catch(function (error) {
                console.error('è·å–å„ç«™NGæ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message, error.stack);
                stationNGChartData = [];
                updateStationNGChart();
            });
    }

    // æ›´æ–°å„ç«™NGä»¶ç»Ÿè®¡å›¾è¡¨
    function updateStationNGChart() {
        if (ryCharts) {
            ryCharts.setOption({
                series: [{
                    data: stationNGChartData
                }]
            });
        }
        // åŒæ—¶æ›´æ–°å„ç«™ä¸è‰¯ç‡åˆ†ææŸ±çŠ¶å›¾
        updateStationNGBarChart(stationNGChartData);
    }

    // æ›´æ–°å„ç«™ä¸è‰¯ç‡åˆ†ææŸ±çŠ¶å›¾
    function updateStationNGBarChart(stationNGData) {
        if (!gCharts) return;

        // ç”ŸæˆOP10-OP170ç«™ç‚¹ç¼–å·æ•°ç»„
        var stationNumbers = generateStationNumbers();

        // åˆ›å»ºç«™ç‚¹ç¼–ç åˆ°æ•°æ®çš„æ˜ å°„
        var stationDataMap = {};
        stationNGData.forEach(function (station) {
            // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„stationCodeå­—æ®µ
            var stationCode = station.stationCode || '';
            // ç¡®ä¿ç«™ç‚¹ç¼–ç æ˜¯OPæ ¼å¼ï¼ˆOP10, OP20, ..., OP170ï¼‰
            if (stationCode && stationCode.startsWith('OP')) {
                // æ£€æŸ¥æ˜¯å¦åœ¨10åˆ°170ä¹‹é—´ä¸”æ˜¯10çš„å€æ•°
                var opNum = parseInt(stationCode.replace('OP', ''), 10);
                if (opNum % 10 === 0 && opNum >= 10 && opNum <= 170) {
                    stationDataMap[stationCode] = {
                        ngCount: station.ngCount || 0,
                        ngRate: station.ngRate || 0
                    };
                }
            }
        });

        // æ ¹æ®ç«™ç‚¹ç¼–å·æ•°ç»„ç”Ÿæˆæ•°æ®æ•°ç»„
        var ngCountData = [];
        var ngRateData = [];
        stationNumbers.forEach(function (stationNumber) {
            var stationData = stationDataMap[stationNumber] || {};
            ngCountData.push(stationData.ngCount || 0);
            // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„ngRateå€¼ï¼Œåœ¨å›¾è¡¨é…ç½®ä¸­è¿›è¡Œç™¾åˆ†æ¯”è½¬æ¢
            ngRateData.push(stationData.ngRate || 0);
        });

        // æ›´æ–°å›¾è¡¨
        gCharts.setOption({
            xAxis: {
                data: stationNumbers
            },
            series: [
                {
                    data: ngCountData
                },
                {
                    data: ngRateData
                }
            ]
        });
    }

    // åŠ è½½é¡¹ç›®ç»Ÿè®¡æ•°æ®
    function loadProjectStatistics() {
        var dateRange = isTestMode ? getTestRange() : getTodayRange();
        var startDate = formatDateTime(dateRange.start);
        var endDate = formatDateTime(dateRange.end);

        console.log('åŠ è½½é¡¹ç›®ç»Ÿè®¡æ•°æ®ï¼Œæ—¶é—´èŒƒå›´:', startDate, '-', endDate);

        // å¹¶è¡Œè·å–æ‰€æœ‰æ•°æ®
        Promise.all([
            calculateFirstPassYield(startDate, endDate, ''),
            calculateQualityRate(startDate, endDate, '')
        ])
            .then(function (results) {
                console.log('è·å–åˆ°é¡¹ç›®ç»Ÿè®¡æ•°æ®:', results);

                var firstPassData = results[0];
                var qualityData = results[1];

                // ä»qualityDataä¸­è·å–è´¨é‡ç»Ÿè®¡æ•°æ®
                var qualityRate = (qualityData.passRate || 0) * 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
                var defectRate = (qualityData.failRate || 0) * 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”

                // ä½¿ç”¨æ¥å£è¿”å›çš„æ•°æ®
                var totalInput = firstPassData.totalInput || 0;
                var firstPassCount = firstPassData.firstPassCount || 0;
                var firstPassYield = (firstPassData.firstPassYield || 0) * 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”

                // æ›´æ–°å¯¹æ¯”æŸ±çŠ¶å›¾
                outputCompareChart.setOption({
                    series: [
                        { name: 'æ€»äº§å‡º', data: [totalInput] },
                        { name: 'ä¸€æ¬¡æ€§é€šè¿‡', data: [firstPassCount] }
                    ]
                });

                // æ›´æ–°å›¾è¡¨æ ‡é¢˜ï¼Œæ˜¾ç¤ºä¸€æ¬¡é€šè¿‡ç‡ç™¾åˆ†æ¯”
                outputCompareChart.setOption({
                    title: {
                        text: 'ä¸€æ¬¡æ€§é€šè¿‡ç‡: ' + firstPassYield.toFixed(1) + '%',
                        left: 'center',
                        bottom: '10%',
                        textStyle: {
                            color: '#fff',
                            fontSize: 14
                        }
                    }
                });

                // ä½¿ç”¨åç«¯ç›´æ¥æä¾›çš„åˆæ ¼å’Œä¸è‰¯äº§å“æ•°é‡
                var qualifiedCount = qualityData.passCount || 0;
                var defectiveCount = qualityData.failCount || 0;

                wzCharts.setOption({
                    series: [{
                        data: [
                            { value: qualityRate, name: 'åˆæ ¼äº§å“', count: qualifiedCount },
                            { value: defectRate, name: 'ä¸è‰¯äº§å“', count: defectiveCount }
                        ]
                    }]
                });
            })
            .catch(function (error) {
                console.error('è·å–é¡¹ç›®ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message, error.stack);
            });
    }

    // åŠ è½½å„ç«™ä¸è‰¯ç‡åˆ†æè¡¨æ ¼æ•°æ®
    function loadStationNGRateTable() {
        var dateRange = isTestMode ? getTestRange() : getTodayRange();
        var startDate = formatDateTime(dateRange.start);
        var endDate = formatDateTime(dateRange.end);

        console.log('åŠ è½½å„ç«™ä¸è‰¯ç‡åˆ†æè¡¨æ ¼æ•°æ®ï¼Œæ—¶é—´èŒƒå›´:', startDate, '-', endDate);

        getStationNGStatistics(startDate, endDate, '')
            .then(function (data) {
                console.log('è·å–åˆ°å„ç«™ä¸è‰¯ç‡åˆ†æè¡¨æ ¼æ•°æ®:', data);

                // æ›´æ–°å„ç«™ä¸è‰¯ç‡åˆ†æè¡¨æ ¼
                var container = document.getElementById('stationNGRateTable');
                if (container) {
                    // æ¸…ç©ºå®¹å™¨
                    container.innerHTML = '';

                    // æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºæ•°ç»„
                    if (!Array.isArray(data)) {
                        container.innerHTML = '<div class="error">æ•°æ®æ ¼å¼é”™è¯¯ï¼Œä¸æ˜¯é¢„æœŸçš„æ•°ç»„æ ¼å¼</div>';
                        return;
                    }

                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    if (data.length === 0) {
                        container.innerHTML = '<div class="no-data">æ²¡æœ‰æ‰¾åˆ°å„ç«™ä¸è‰¯ç‡åˆ†ææ•°æ®</div>';
                        return;
                    }

                    // åˆ›å»ºè¡¨æ ¼æ¥å±•ç¤ºæ•°æ®
                    var table = document.createElement('table');
                    table.className = 'finished-product-table';

                    // åˆ›å»ºè¡¨å¤´
                    var thead = document.createElement('thead');
                    var headerRow = document.createElement('tr');
                    headerRow.innerHTML = '<th>ç«™ç‚¹ç¼–ç </th><th>ç«™ç‚¹åç§°</th><th>ä¸è‰¯å“æ•°é‡</th><th>æ€»æµ‹è¯•æ•°é‡</th><th>ä¸è‰¯ç‡</th>';
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // åˆ›å»ºè¡¨æ ¼å†…å®¹
                    var tbody = document.createElement('tbody');

                    // æŒ‰ç«™ç‚¹ç¼–ç æ’åº
                    data.sort(function (a, b) {
                        return a.stationCode.localeCompare(b.stationCode);
                    });

                    data.forEach(function (item) {
                        var row = document.createElement('tr');
                        // è®¡ç®—ä¸è‰¯ç‡ç™¾åˆ†æ¯”
                        var ngRatePercent = (item.ngRate * 100).toFixed(2);

                        // åˆ›å»ºè¡¨æ ¼å•å…ƒæ ¼
                        row.innerHTML = '<td>' + (item.stationCode || 'æœªçŸ¥ç¼–ç ') + '</td>' +
                            '<td>' + (item.stationName || 'æœªçŸ¥ç«™ç‚¹') + '</td>' +
                            '<td>' + (item.ngCount || 0) + '</td>' +
                            '<td>' + (item.totalTestCount || 0) + '</td>' +
                            '<td>' + ngRatePercent + '%</td>';
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);

                    // æ·»åŠ è¡¨æ ¼åˆ°å®¹å™¨
                    container.appendChild(table);
                }
            })
            .catch(function (error) {
                console.error('è·å–å„ç«™ä¸è‰¯ç‡åˆ†æè¡¨æ ¼æ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message, error.stack);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                var container = document.getElementById('stationNGRateTable');
                if (container) {
                    container.innerHTML = '<div class="error">è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
                }
            });
    }

    // åŠ è½½äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åæ•°æ®
    function loadFinishedProductCount() {
        var dateRange = isTestMode ? getTestRange() : getTodayRange();
        var startDate = formatDateTime(dateRange.start);
        var endDate = formatDateTime(dateRange.end);

        console.log('åŠ è½½äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åæ•°æ®ï¼Œæ—¶é—´èŒƒå›´:', startDate, '-', endDate);

        getFinishedProductCount(startDate, endDate, '')
            .then(function (data) {
                console.log('è·å–åˆ°äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åæ•°æ®:', data);

                // æ›´æ–°äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’ååˆ—è¡¨
                var container = document.getElementById('finishedProductList');
                if (container) {
                    // æ¸…ç©ºå®¹å™¨
                    container.innerHTML = '';

                    // æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºæ•°ç»„
                    if (!Array.isArray(data)) {
                        container.innerHTML = '<div class="error">æ•°æ®æ ¼å¼é”™è¯¯ï¼Œä¸æ˜¯é¢„æœŸçš„æ•°ç»„æ ¼å¼</div>';
                        return;
                    }

                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    if (data.length === 0) {
                        container.innerHTML = '<div class="no-data">æ²¡æœ‰æ‰¾åˆ°äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ•°æ®</div>';
                        return;
                    }

                    // åˆ›å»ºè¡¨æ ¼æˆ–åˆ—è¡¨æ¥å±•ç¤ºæ•°æ®
                    var table = document.createElement('table');
                    table.className = 'finished-product-table';

                    // åˆ›å»ºè¡¨å¤´
                    var thead = document.createElement('thead');
                    var headerRow = document.createElement('tr');
                    headerRow.innerHTML = '<th>æ’å</th><th>äº§å“åç§°</th><th>æ€»å®Œå·¥æ•°é‡</th><th>åˆæ ¼ç‡</th>';
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // åˆ›å»ºè¡¨æ ¼å†…å®¹
                    var tbody = document.createElement('tbody');
                    // åªæ˜¾ç¤ºå‰5å
                    data = data.slice(0, 5);
                    data.forEach(function (item, index) {
                        var row = document.createElement('tr');
                        // è®¡ç®—åˆæ ¼ç‡
                        var passRate = item.totalFinishedCount > 0 ? (item.passFinishedCount / item.totalFinishedCount * 100).toFixed(1) : '0.0';
                        // åˆ›å»ºè¡¨æ ¼å•å…ƒæ ¼
                        row.innerHTML = '<td>' + (index + 1) + '</td>' +
                            '<td>' + (item.productName || 'æœªçŸ¥äº§å“') + '</td>' +
                            '<td>' + (item.totalFinishedCount || 0) + '</td>' +
                            '<td>' + passRate + '%</td>';
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);

                    // æ·»åŠ è¡¨æ ¼åˆ°å®¹å™¨
                    container.appendChild(table);
                }
            })
            .catch(function (error) {
                console.error('è·å–äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åæ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message, error.stack);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                var container = document.getElementById('finishedProductList');
                if (container) {
                    container.innerHTML = '<div class="error">è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
                }
            });
    }

    // åŠ è½½æ•°æ®å°†åœ¨æ‰€æœ‰å›¾è¡¨åˆå§‹åŒ–åæ‰§è¡Œ

    // ç”ŸæˆOP10-OP170ç«™ç‚¹ç¼–å·æ•°ç»„
    function generateStationNumbers() {
        var stations = [];
        for (var i = 1; i <= 17; i++) {
            var number = i * 10;
            stations.push('OP' + number);
        }
        return stations;
    }

    // å„ç«™ä¸è‰¯ç‡åˆ†ææŸ±çŠ¶å›¾
    var gdom = document.getElementById("gCharts");
    var gCharts = echarts.init(gdom);
    var ptoption = {
        title: {
            show: false
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            },
            formatter: function (params) {
                if (!params || !params.length) return '';
                var result = ['ç«™ç‚¹: ' + params[0].name];

                params.forEach(function (param) {
                    if (param.seriesName === 'ä¸è‰¯å“æ•°é‡') {
                        result.push('ä¸è‰¯å“æ•°é‡: ' + param.value + 'ä»¶');
                    } else if (param.seriesName === 'ä¸è‰¯ç‡') {
                        // å°†å°æ•°è½¬æ¢ä¸ºç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œä¿ç•™ä¸¤ä½å°æ•°
                        result.push('ä¸è‰¯ç‡: ' + (param.value * 100).toFixed(2) + '%');
                    }
                });

                return result.join('<br/>');
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '10%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: generateStationNumbers(),
            axisLine: {
                lineStyle: {
                    color: '#5dc2fe'
                }
            },
            axisLabel: {
                textStyle: {
                    color: '#5dc2fe',
                    fontSize: 10,
                    rotate: 45
                }
            },
            splitLine: {
                show: false
            }
        },
        yAxis: [
            {
                type: 'value',
                name: 'ä¸è‰¯å“æ•°é‡(ä»¶)',
                nameTextStyle: {
                    color: '#5dc2fe',
                    fontSize: 12
                },
                axisLine: {
                    lineStyle: {
                        color: '#5dc2fe'
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#5dc2fe'
                    },
                    formatter: '{value}'
                },
                splitLine: {
                    lineStyle: {
                        color: 'rgba(93, 194, 254, 0.2)'
                    }
                },
                minInterval: 1, // ç¡®ä¿æœ€å°é—´éš”ä¸º1
                splitNumber: 5 // è®¾ç½®åˆé€‚çš„åˆ†å‰²æ•°é‡
            },
            {
                type: 'value',
                name: 'ä¸è‰¯ç‡(%)',
                nameTextStyle: {
                    color: '#FFCC00',
                    fontSize: 12
                },
                axisLine: {
                    lineStyle: {
                        color: '#FFCC00'
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#FFCC00'
                    },
                    formatter: function (value) {
                        // å°†å°æ•°è½¬æ¢ä¸ºç™¾åˆ†æ¯”æ˜¾ç¤º
                        return (value * 100).toFixed(1) + '%';
                    }
                },
                splitLine: {
                    show: false
                },
                min: 0,
                max: 0.2, // ä½¿ç”¨å°æ•°å½¢å¼çš„æœ€å¤§å€¼ï¼ˆ0.2ä»£è¡¨20%ï¼‰
                interval: 0.05 // ä½¿ç”¨å°æ•°å½¢å¼çš„é—´éš”ï¼ˆ0.05ä»£è¡¨5%ï¼‰
            }
        ],
        series: [
            {
                name: 'ä¸è‰¯å“æ•°é‡',
                type: 'bar',
                yAxisIndex: 0,
                data: [],
                barWidth: 24,
                itemStyle: {
                    normal: {
                        color: '#1890ff',
                        borderRadius: [10, 10, 0, 0]
                    }
                },
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#5dc2fe',
                        fontSize: 10,
                        formatter: '{c}'
                    }
                }
            },
            {
                name: 'ä¸è‰¯ç‡',
                type: 'line',
                yAxisIndex: 1,
                data: [],
                itemStyle: {
                    normal: {
                        color: '#FFCC00'
                    }
                },
                lineStyle: {
                    normal: {
                        color: '#FFCC00',
                        width: 2
                    }
                },
                symbol: 'circle',
                symbolSize: 6,
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#FFCC00',
                        fontSize: 10,
                        formatter: function (params) {
                            // å°†å°æ•°è½¬æ¢ä¸ºç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œä¿ç•™ä¸¤ä½å°æ•°
                            return (params.value * 100).toFixed(2) + '%';
                        }
                    }
                }
            }
        ]
    };
    if (ptoption && typeof ptoption === "object") {
        gCharts.setOption(ptoption, true);
    }

    //å„ç«™NGä»¶ç»Ÿè®¡ 
    var rydom = document.getElementById("ryCharts");
    var ryCharts = echarts.init(rydom);
    ryoption = {
        title: { text: 'å„ç«™NGä»¶ç»Ÿè®¡', x: 'center', y: 'top', textStyle: { fontSize: 16, fontWeight: 'bold', color: '#5dc2fe' }, show: false },
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                if (!params) return '';
                // NGç‡å·²åœ¨æ•°æ®å¤„ç†æ—¶ä¿ç•™3ä½æœ‰æ•ˆæ•°å­—
                return [
                    'ç«™ç‚¹: ' + params.name,
                    'NGæ•°é‡: ' + params.value,
                    'NGç‡: ' + (params.data.ngRate * 100).toFixed(2) + '%',
                    'å æ¯”: ' + params.percent + '%'
                ].join('<br/>');
            }
        },
        legend: {
            orient: 'vertical',
            x: 'left',
            y: 'top',
            itemWidth: 24,
            itemHeight: 18,
            textStyle: { color: '#5dc2fe' },
            itemGap: 15,
            formatter: function (name) {
                var item = stationNGChartData.find(function (item) { return item.name === name; });
                return name + ': ' + (item ? item.value : 0);
            }
        },
        calculable: true,
        color: [
            '#1890ff', '#52c41a', '#faad14', '#f5222d',
            '#722ed1', '#13c2c2', '#eb2f96', '#fa8c16',
            '#a0d911', '#2f54eb', '#fa541c', '#8c8c8c'
        ],
        series: [{
            name: 'å„ç«™NGä»¶ç»Ÿè®¡',
            type: 'pie',
            radius: ['30%', '70%'],
            center: ['60%', '45%'],
            data: [], // åˆå§‹ä¸ºç©ºï¼Œç”±loadStationNGDataå¡«å……
            itemStyle: {
                emphasis: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(30, 144, 255, 0.5)'
                }
            },
            label: {
                type: 'outer',
                formatter: '{name}: {value} ({d}%)',
                textStyle: {
                    color: '#5dc2fe',
                    fontSize: 12
                }
            }
        }]
    };
    if (ryoption && typeof ryoption === "object") {
        ryCharts.setOption(ryoption, true);
    }

    //åˆæ ¼äº§å“ä¸ä¸è‰¯äº§å“é¥¼å›¾
    var wzdom = document.getElementById("wzCharts");
    var wzCharts = echarts.init(wzdom);
    wzoption = {
        title: { text: 'åˆæ ¼ç‡åˆ†æ', show: false },
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                return params.seriesName + '<br/>' +
                    params.marker + params.name + ': ' + params.data.count + 'ä¸ª (' + params.percent + '%)';
            }
        },
        legend: { orient: 'vertical', x: 'left', y: 'top', itemWidth: 20, itemHeight: 15, textStyle: { color: '#5dc2fe' }, itemGap: 10, data: ['åˆæ ¼äº§å“', 'ä¸è‰¯äº§å“'] },
        calculable: true,
        color: ['#3CB371', '#8B0000'],
        series: [{
            name: 'åˆæ ¼ç‡ä¸ä¸è‰¯ç‡åˆ†æ',
            type: 'pie',
            radius: ['30%', '60%'],
            center: ['60%', '50%'],
            data: [{ value: 0, name: 'åˆæ ¼äº§å“', count: 0 }, { value: 0, name: 'ä¸è‰¯äº§å“', count: 0 }],
            itemStyle: { emphasis: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(30, 144, 255, 0.5)' } },
            labelLine: { normal: { show: false } },
            label: { normal: { position: 'inner', formatter: '{d}%' } }
        }]
    };
    if (wzoption && typeof wzoption === "object") {
        wzCharts.setOption(wzoption, true);
    }

    //äº§å“å®Œæˆç”Ÿäº§æ•°é‡æ’åä½¿ç”¨è¡¨æ ¼å±•ç¤ºï¼Œæ— éœ€å›¾è¡¨åˆå§‹åŒ–

    // ä¸€æ¬¡æ€§é€šè¿‡ç‡å¯¹æ¯”æŸ±çŠ¶å›¾
    var outputCompareDom = document.getElementById("outputCompareChart");
    var outputCompareChart = echarts.init(outputCompareDom);
    var outputCompareOption = {
        title: { text: 'ä¸€æ¬¡æ€§é€šè¿‡ç‡', show: false },
        color: ['#00CCFF', '#CC6600'],
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                var totalOutput = params[0].value;
                var firstPass = params[1].value;
                var firstPassRate = totalOutput > 0 ? (firstPass / totalOutput * 100).toFixed(1) : '0.0';
                return params[0].name + '<br/>' +
                    params[0].marker + params[0].seriesName + ': ' + totalOutput + '<br/>' +
                    params[1].marker + params[1].seriesName + ': ' + firstPass + '<br/>' +
                    'ä¸€æ¬¡æ€§é€šè¿‡ç‡: ' + firstPassRate + '%';
            }
        },
        legend: { orient: 'vertical', data: ['æ€»äº§å‡º', 'ä¸€æ¬¡æ€§é€šè¿‡'], x: 'left', y: 'center', textStyle: { color: '#5dc2fe' }, itemWidth: 20, itemHeight: 15, itemGap: 10 },
        grid: { left: '30%', right: '20%', top: '10%', bottom: '10%', containLabel: true },
        calculable: true,
        xAxis: [{
            type: 'category',
            data: ['ä»Šæ—¥'],
            axisLine: { lineStyle: { color: "#5dc2fe" } },
            splitLine: { show: false },
            axisLabel: { textStyle: { color: '#5dc2fe' } }
        }],
        yAxis: [{
            type: 'value',
            axisLine: { lineStyle: { color: "#5dc2fe" } },
            splitLine: { show: false },
            axisLabel: { textStyle: { color: '#5dc2fe' } },
            splitNumber: 3
        }],
        series: [
            {
                name: 'æ€»äº§å‡º',
                type: 'bar',
                data: [0],
                barWidth: 24,
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#5dc2fe',
                        fontSize: 12
                    }
                }
            },
            {
                name: 'ä¸€æ¬¡æ€§é€šè¿‡',
                type: 'bar',
                data: [0],
                barWidth: 24,
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                        color: '#5dc2fe',
                        fontSize: 12
                    }
                }
            }
        ]
    };
    if (outputCompareOption && typeof outputCompareOption === "object") {
        outputCompareChart.setOption(outputCompareOption, true);
    }

    // TOP10ç¼ºé™·åˆ†æé¥¼å›¾
    var topDefectsDom = document.getElementById("topDefectsChart");
    var topDefectsChart = echarts.init(topDefectsDom);
    var topDefectsOption = {
        title: {
            show: true,
            left: 'center',
            textStyle: {
                color: '#5dc2fe',
                fontSize: 14
            }
        },
        color: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#8AC249', '#FF6D00', '#795548', '#607D8B'],
        tooltip: {
            trigger: 'item',
            formatter: '{b}: {c}ä»¶ ({d}%)'
        },
        legend: {
            orient: 'vertical',
            right: 'right',
            top: 'center',
            textStyle: {
                color: '#5dc2fe',
                fontSize: 10
            },
            itemWidth: 12,
            itemHeight: 12,
            itemGap: 8
        },
        series: [
            {
                name: 'ç¼ºé™·ç±»å‹',
                type: 'pie',
                radius: ['40%', '70%'],
                center: ['40%', '50%'],
                avoidLabelOverlap: false,
                itemStyle: {
                    borderRadius: 4,
                    borderColor: '#0F1A2A',
                    borderWidth: 2
                },
                label: {
                    show: false,
                    position: 'center'
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 16,
                        fontWeight: 'bold',
                        color: '#5dc2fe'
                    }
                },
                labelLine: {
                    show: false
                },
                data: []
            }
        ]
    };

    // æ›´æ–°TOPç¼ºé™·å›¾è¡¨
    function updateTopDefectsChart() {
        if (topDefectsChart) {
            topDefectsChart.setOption({
                series: [
                    {
                        data: topDefectsChartData
                    }
                ]
            });
        }
    }

    // å¦‚æœæœ‰åˆå§‹é…ç½®ï¼Œè®¾ç½®å›¾è¡¨
    if (topDefectsOption && typeof topDefectsOption === "object") {
        topDefectsChart.setOption(topDefectsOption, true);
    }

    // ç°åœ¨æ‰€æœ‰å›¾è¡¨éƒ½å·²åˆå§‹åŒ–ï¼Œå¼€å§‹åŠ è½½æ•°æ®
    loadChartData();
    loadStationNGData();
    loadProjectStatistics();
    loadFinishedProductCount();

    //çª—å£è‡ªé€‚åº”
    window.onresize = function () {
        myChart.resize();
        gCharts.resize();
        ryCharts.resize();

        wzCharts.resize();
        outputCompareChart.resize();
        topDefectsChart.resize();
    }

</script>

</html>